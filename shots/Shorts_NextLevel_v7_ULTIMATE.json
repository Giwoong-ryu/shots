{
  "name": "Shorts_NextLevel_v7_ULTIMATE",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "minutes": 0
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -1980,
        -1400
      ],
      "id": "trigger_schedule",
      "name": "Daily Trigger"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "shorts-v7",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1980,
        -1200
      ],
      "id": "webhook_start",
      "name": "Webhook"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c1",
              "leftValue": "={{ $json.body.trigger_type }}",
              "rightValue": "generate_narration",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1760,
        -1300
      ],
      "id": "router_trigger",
      "name": "If: Generate New?"
    },
    {
      "parameters": {
        "jsCode": "// Prepare Data for New Script\nconst body = $input.item.json.body || {};\nreturn {\n  json: {\n    title: body.title || \"Latest AI News\",\n    summary: body.summary || \"AI technology is evolving fast...\",\n    newsContent: body.newsContent || \"\",\n    row_number: body.row_number || 0\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1540,
        -1420
      ],
      "id": "prep_new_data",
      "name": "Prepare New Data"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# News Contents:\n- title: \"{{ $json.title }}\",\n- {{ $json.summary }}\n- Content: \"{{ $json.newsContent }}\",\n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=# System Prompt: ë‰´ìŠ¤ì •ë³´ë¥¼ ìœ íˆ¬ë¸Œ ì‡¼ì¸  ìš© 'narration'ìœ¼ë¡œ ì¬êµ¬ì„± í•˜ê¸°\n\n## Overview\në‹¹ì‹ ì€ ìœ íŠœë¸Œ ì‡¼ì¸  'narration'ì„ ìƒì„±í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì œê³µí•˜ëŠ” 'News Contents'ë¥¼ 6ë¬¸ì¥ìœ¼ë¡œ ì´ë£¨ì–´ì§„ ì‡¼ì¸  ìš© 'narration'ìœ¼ë¡œ ì¬êµ¬ì„±í•˜ì„¸ìš”. ì•„ë˜ ì£¼ì–´ì§„ ê·œì¹™ì„ ë°˜ë“œì‹œ ì •í™•í•˜ê²Œ ì§€í‚¤ì„¸ìš”.\n\n'News Contents'ê°€ ì£¼ì–´ì§€ë©´ 6ë¬¸ì¥ìœ¼ë¡œ ì´ë£¨ì–´ì§„ Narrationì„ ì‘ì„±í•©ë‹ˆë‹¤. \n\n## Writing Style Reference\n\"ë§ˆí¬ ì €í¬ë²„ê·¸ê°€ íŒì„ í¬ê²Œ ë²Œì´ê³  ìˆìŠµë‹ˆë‹¤. ë©”íƒ€ì˜ ìŠˆí¼ì¸í…”ë¦¬ì „ìŠ¤ ì¶œë²” ì´ì•¼ê¸°ì…ë‹ˆë‹¤. ì–¼ë§ˆì „ 143ì–µ ë‹¬ëŸ¬ ê±°ì•¡ì„ ì£¼ê³  ìŠ¤ì¼€ì¼ AIì˜ ì•Œë ‰ì‚°ë” ì™•ì„ ì˜ì…í–ˆì—ˆì§€ìš”. AI í•µì‹¬ ì¸ì¬ 11ëª…ì„ ì¶”ê°€ë¡œ ìŠ¤ì¹´ìš°íŠ¸í•´ ìƒˆë¡œìš´ AI ì¡°ì§ì„ ë§Œë“  ê²ƒì…ë‹ˆë‹¤. í˜„ì¬ í¼í”Œë ‰ì‹œí‹°, ëŸ°ì›¨ì´ AI ë“± êµµì§í•œ AI ì—…ì²´ë“¤ê³¼ ì¸ìˆ˜í•©ë³‘ë„ ì§„í–‰ ì¤‘ì´ë¼ê³  í•©ë‹ˆë‹¤. ì•ìœ¼ë¡œ ì˜¤í”ˆAI, êµ¬ê¸€ ë“± ì„ ë‘ AI ì—…ì²´ë“¤ê³¼ì˜ ê²½ìŸì´ ì¹˜ì—´í•´ ì§€ê² ë„¤ìš”.\"\n\n## Rules   \n1. ë¬¸ì¥ 6ê°œë¡œ 'narration'ì„ ì‘ì„±í•©ë‹ˆë‹¤. \n2. í•œ ë¬¸ì¥ì˜ ê¸¸ì´ëŠ” 40ì ë‚´ì™¸ì…ë‹ˆë‹¤. \n2. ì „ì²´ ë¶„ëŸ‰ì€ 250ì ë‚´ì™¸ì…ë‹ˆë‹¤.\n3. ë‚´ìš©  \n   - ë¬¸ì¥1: Hook ë¬¸ì¥ (í¥ë¯¸ë¥¼ ëŒë§Œí•œ ì‚¬ì‹¤ë¡œ ë§¤ë ¥ì ì¸ ì˜¤í”„ë‹)\n   - ë¬¸ì¥2~ë¬¸ì¥6: ë””í…Œì¼í•œ ë‰´ìŠ¤ ì „ë‹¬ (êµ¬ì²´ì ì¸ ë¸Œëœë“œëª… ì¸ë¬¼ëª… ìˆ˜ì¹˜ ì¸ìš©)\n4. ì œê³µëœ 'Writing Style Reference'ì™€ ë˜‘ê°™ì€ ì–´íˆ¬(ì¢…ê²° í‘œí˜„, ì–´ë¯¸, í˜¸í¡ ë“±)ë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤. \n5. ë°˜ë§, ë²ˆì—­ì²´, ë»”í•œ ë¬¸êµ¬ ê¸ˆì§€\n\n## Failure Controls\nâš ï¸ ë¬¸ì¥ ê°¯ìˆ˜ê°€ ë¶€ì¡±í•˜ê±°ë‚˜ ì´ˆê³¼ ì‹œ:\n\"âŒ sentence count is X, expected 6\" ê°™ì€ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ê³  ì¬ì‹œë„í•´ì£¼ì„¸ìš”.\n\nâš ï¸ ìŠ¤íƒ€ì¼ ë¶ˆì¼ì¹˜ ì‹œ:\n\"âŒ 'Writing Style Reference' is X, expected 'copy the style'\" ê°™ì€ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ê³  ì¬ì‹œë„í•´ì£¼ì„¸ìš”.\n\n# OUTPUT í˜•ì‹  \n```json\n{\n  \"narration\": \"ë¬¸ì¥1 + ë¬¸ì¥2 + ë¬¸ì¥3 + ë¬¸ì¥4 + ë¬¸ì¥5 + ë¬¸ì¥6\",\n  \"sentence\": {\n    \"sentence 0\": \"ë¬¸ì¥1\",\n    \"sentence 1\": \"ë¬¸ì¥2\",\n    \"sentence 2\": \"ë¬¸ì¥3\",\n    \"sentence 3\": \"ë¬¸ì¥4\",\n    \"sentence 4\": \"ë¬¸ì¥5\",\n    \"sentence 5\": \"ë¬¸ì¥6\"\n  }\n}\n```"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1320,
        -1420
      ],
      "id": "agent_script",
      "name": "Narration Script Generate"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "GPT-5-MINI",
          "mode": "list",
          "cachedResultName": "GPT-5-MINI"
        },
        "options": {
          "temperature": 0.7,
          "maxTokens": 2000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -1320,
        -1260
      ],
      "id": "model_script",
      "name": "GPT-5.1 Model",
      "credentials": {
        "openAiApi": {
          "id": "YOUR_OPENAI_CREDENTIAL_ID",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"narration\": \"ë¬¸ì¥1 + ë¬¸ì¥2...\",\n  \"sentence\": {\n    \"sentence 0\": \"ë¬¸ì¥1\",\n    \"sentence 1\": \"ë¬¸ì¥2\",\n    \"sentence 2\": \"ë¬¸ì¥3\",\n    \"sentence 3\": \"ë¬¸ì¥4\",\n    \"sentence 4\": \"ë¬¸ì¥5\",\n    \"sentence 5\": \"ë¬¸ì¥6\"\n  }\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1,
      "position": [
        -1160,
        -1420
      ],
      "id": "parser_script",
      "name": "Script Parser"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "YOUR_GOOGLE_SHEET_ID",
          "mode": "list",
          "cachedResultName": "Shorts Automation"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": []
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -980,
        -1420
      ],
      "id": "log_script",
      "name": "Log Script (AutoMap)",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YOUR_GOOGLE_SHEETS_CREDENTIAL_ID",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Prepare Sentences with Fallback\nconst input = items[0].json;\nconst rowNumber = input.row_number || 0;\nlet narrationText = input.output?.narration || input.body?.narration_confirmed || \"\";\n\nif (!narrationText) throw new Error(\"No narration text found!\");\n\nlet splitSentences = narrationText.split(/[.!?ã€‚]\\s*/).filter(s => s.trim());\nif (splitSentences.length !== 6) {\n  const newlineSplit = narrationText.split('\\n').filter(s => s.trim());\n  if (newlineSplit.length >= 2) splitSentences = newlineSplit;\n}\nif (splitSentences.length !== 6) {\n  const avgLength = Math.ceil(narrationText.length / 6);\n  const parts = [];\n  let pos = 0;\n  for (let i = 0; i < 6; i++) {\n    let end = (i === 5) ? narrationText.length : pos + avgLength;\n    parts.push(narrationText.slice(pos, end).trim());\n    pos = end;\n  }\n  splitSentences = parts.filter(s => s);\n}\nwhile (splitSentences.length < 6) splitSentences.push(\"...\");\nsplitSentences = splitSentences.slice(0, 6);\n\nconst sentences = {};\nsplitSentences.forEach((s, i) => sentences[`sentence_${i}`] = s);\nreturn [{ json: { sentences, row_number: rowNumber } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -800,
        -1300
      ],
      "id": "prep_sentences",
      "name": "Prepare Sentences"
    },
    {
      "parameters": {
        "fieldToSplitOut": "sentences",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -600,
        -1300
      ],
      "id": "split_sentences",
      "name": "Split Sentences"
    },
    {
      "parameters": {
        "amount": 3,
        "unit": "seconds"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -420,
        -1300
      ],
      "id": "wait_throttle_1",
      "name": "Wait 3s"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# INPUT  \n\"sentence\":{{ $json.value }}\n\nìœ„ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ, **System Prompt**ì˜ ê·œì¹™ëŒ€ë¡œ `image_prompt`ë¥¼ ìƒì„±í•˜ì„¸ìš”.\n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=# System Prompt: ë‰´ìŠ¤ì •ë³´ë¥¼ ëª°ì…ê° ë„˜ì¹˜ëŠ” ì´ë¯¸ì§€ë¡œ ì¬êµ¬ì„± í•˜ê¸°\n\n## Overview ë‹¹ì‹ ì€ 30ì´ˆ ìœ íˆ¬ë¸Œ ì‡¼ì¸  ì œì‘ì„ ìœ„í•œ ì»¨í…ì¸  ìƒì„±ì— íŠ¹í™”ëœ ë©€í‹°ëª¨ë‹¬ í¬ë¦¬ì—ì´í‹°ë¸Œ AIì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì œê³µí•˜ëŠ” â€˜sentenceâ€™ë¥¼ ë°”íƒ•ìœ¼ë¡œ íŒ©íŠ¸ ê¸°ë°˜ì˜ ëª°ì…ê° ìˆëŠ” ì´ë¯¸ì§€ë¡œ ë§Œë“¤ì–´ëƒ…ë‹ˆë‹¤. \n\n'sentence'ê°€ í•œì¤„ ì£¼ì–´ì§‘ë‹ˆë‹¤.  ë‹¹ì‹ ì˜ ì„ë¬´ëŠ” ë‹¤ìŒì„ ì¶œë ¥í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. \n\n## Rules \n-'sentence'ë¥¼ ì‹œê°ì ìœ¼ë¡œ ì˜ ì „ë‹¬í•˜ê¸° ìœ„í•œ ì¥ë©´ì„ ì—°ì¶œí•˜ê³  ì„¤ëª…í•˜ì„¸ìš”. (300ì)\n- ì´ í”„ë¡¬í”„íŠ¸ëŠ” ì‹œì²­ìê°€ 'sentence' ë‚´ìš©ì— ë¹ ì ¸ë“¤ë„ë¡ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.\n- 'sentence'ì— ë“±ì¥í•œ êµ¬ì²´ì ì¸ ë°°ê²½, ì‚¬ë¬¼, ìƒí™© ë“±ì„ í‚¤ì›Œë“œ ì¤‘ì‹¬ìœ¼ë¡œ ë¬˜ì‚¬í•˜ì„¸ìš”. \n- 'sentence'ì— ë“±ì¥í•˜ëŠ” íšŒì‚¬ë‚˜ ë¸Œëœë“œì˜ ë¡œê³ , ì‹¬ë³¼, ìƒì§•ì ì¸ ì œí’ˆ ë“±ì„ ê³¼ì¥í•´ í‘œí˜„í•©ë‹ˆë‹¤.\n- 'sentence'ì— ë“±ì¥í•˜ëŠ” ì¸ë¬¼ì´ë‚˜ ì‚¬ëŒë“¤ì˜ í–‰ë™ì´ë‚˜ ê°ì • ë“±ì´ ê·¹ì ìœ¼ë¡œ ë“œëŸ¬ë‚  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. \n- ìƒì„±ëœ í”„ë¡¬í”„íŠ¸ëŠ” ì˜ˆìˆ ì  ê°ìˆ˜ì„±, í’ë¶€í•œ ìƒìƒë ¥, ê¹Šì€ ë§Œì¡±ê°ì„ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤. \n- ìŠ¤íƒ€ì¼ í‚¤ì›Œë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.: realistic, neon HUD, Hyper-realistic, Glowing, Translucent, Crystalline, electromagnetic, radiant glints\n \n\n## ì¶œë ¥í˜•ì‹\nê° 'scentence'ì— ëŒ€í•´ ì•„ë˜ì™€ ê°™ì´ ì‘ë‹µí•˜ì„¸ìš”.\n- Image Prompt:\n\n## ì¶œë ¥ì˜ˆì‹œ\n- Image Prompt: In a cyberâ€‘punk lab lit by neon indigoâ€‘violet haze, a translucent â€œLightShedâ€ logo hologram hovers over server towers. A hooded hacker taps artistâ€‘shield panels that fracture to pixel dust; before/after screens blink â€œPROTECTIONâ€¯BYPASSEDâ€. Warm artwork orbs drift amid cold chrome while electric data streams whip through exposed fibers, scattering sparks across misty steel floors."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -240,
        -1300
      ],
      "id": "agent_img_prompt",
      "name": "Generate Image Prompt"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "GPT-5-MINI",
          "mode": "list",
          "cachedResultName": "GPT-5-MINI"
        },
        "options": {
          "temperature": 0.7,
          "maxTokens": 1000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -240,
        -1140
      ],
      "id": "model_img_prompt",
      "name": "GPT-5.1 Model (Image)",
      "credentials": {
        "openAiApi": {
          "id": "YOUR_OPENAI_CREDENTIAL_ID",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://queue.fal.run/fal-ai/nano-banana/edit",
        "method": "POST",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Key YOUR_FAL_KEY"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "jsonBody": "={\n  \"prompt\": \"{{ $json.output.image_prompt }}\",\n  \"image_size\": \"1080x1920\",\n  \"num_inference_steps\": 30\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        60,
        -1300
      ],
      "id": "gen_image_nano",
      "name": "NanoBanana Image Gen"
    },
    {
      "parameters": {
        "url": "https://api.openai.com/v1/videos",
        "method": "POST",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer YOUR_OPENAI_API_KEY"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "jsonBody": "={\n  \"model\": \"sora-2\",\n  \"prompt\": \"{{ $json.output.image_prompt }}\",\n  \"image_url\": \"{{ $json.images[0].url }}\",\n  \"size\": \"1080x1920\",\n  \"quality\": \"hd\",\n  \"duration\": \"5\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        360,
        -1300
      ],
      "id": "gen_video_sora",
      "name": "Sora-2 (OpenAI)"
    },
    {
      "parameters": {
        "resource": "audio",
        "input": "={{ $('Prepare Sentences').item.json.sentences.sentence_0 }} {{ $('Prepare Sentences').item.json.sentences.sentence_1 }} {{ $('Prepare Sentences').item.json.sentences.sentence_2 }} {{ $('Prepare Sentences').item.json.sentences.sentence_3 }} {{ $('Prepare Sentences').item.json.sentences.sentence_4 }} {{ $('Prepare Sentences').item.json.sentences.sentence_5 }}",
        "voice": "alloy",
        "options": {
          "response_format": "mp3",
          "speed": 1
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -420,
        -1000
      ],
      "id": "gen_audio_tts",
      "name": "OpenAI TTS",
      "credentials": {
        "openAiApi": {
          "id": "YOUR_OPENAI_CREDENTIAL_ID",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/audio/transcriptions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            },
            {
              "name": "model",
              "value": "whisper-1"
            },
            {
              "name": "response_format",
              "value": "verbose_json"
            },
            {
              "name": "timestamp_granularities[]",
              "value": "word"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -120,
        -1000
      ],
      "id": "gen_subtitles_whisper",
      "name": "Whisper (Word-Level)",
      "credentials": {
        "httpBearerAuth": {
          "id": "YOUR_OPENAI_CREDENTIAL_ID",
          "name": "Bearer Auth account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// === ì™„ì „í•œ Whisper ë°ì´í„° ì²˜ë¦¬ ë…¸ë“œ (ì•½ì–´ ì²˜ë¦¬ ê°œì„ ) ===\n// ë¬¸ì¥ ë‹¨ìœ„ ì—°ì† ì„¸ê·¸ë¨¼íŠ¸ ìƒì„± + Word Subtitle + ASS Animation í†µí•©\n\nconsole.log('ğŸ¬ ì™„ì „í•œ Whisper ë°ì´í„° ì²˜ë¦¬ ì‹œì‘');\n\nconst inputData = $input.first().json;\nlet whisperData;\n\n// === 1ë‹¨ê³„: Whisper ë°ì´í„° ì¶”ì¶œ ===\ntry {\n  if (inputData.data && typeof inputData.data === 'string') {\n    whisperData = JSON.parse(inputData.data);\n  } else if (inputData.data) {\n    whisperData = inputData.data;\n  } else {\n    whisperData = inputData;\n  }\n  \n  console.log('ğŸ“Š Whisper ë°ì´í„° í™•ì¸:', {\n    hasSegments: !!whisperData.segments,\n    segmentCount: whisperData.segments?.length,\n    hasWords: !!whisperData.words,\n    wordCount: whisperData.words?.length,\n    duration: whisperData.duration\n  });\n  \n} catch (error) {\n  console.log('âŒ Whisper ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', error.message);\n  return [{ json: { error: 'Whisper data parsing failed', inputData } }];\n}\n\n// === 2ë‹¨ê³„: ì „ì²´ í…ìŠ¤íŠ¸ ê²°í•© ë° ê°œì„ ëœ ë¬¸ì¥ ë¶„ë¦¬ ===\nconsole.log('ğŸ“ ê°œì„ ëœ ë¬¸ì¥ ë‹¨ìœ„ ë¶„ë¦¬ ì‹œì‘...');\n\nconst { segments, words } = whisperData;\n\n// ëª¨ë“  ì„¸ê·¸ë¨¼íŠ¸ì˜ í…ìŠ¤íŠ¸ë¥¼ í•˜ë‚˜ë¡œ ê²°í•©\nconst fullText = segments.map(seg => seg.text.trim()).join(' ');\nconsole.log('ğŸ”¤ ì „ì²´ í…ìŠ¤íŠ¸:', fullText);\n\n// ê°œì„ ëœ ë¬¸ì¥ ë¶„ë¦¬ í•¨ìˆ˜\nfunction smartSentenceSplit(text) {\n  console.log('ğŸ” ìŠ¤ë§ˆíŠ¸ ë¬¸ì¥ ë¶„ë¦¬ ì‹œì‘...');\n  console.log('ğŸ”¤ ì›ë³¸ í…ìŠ¤íŠ¸:', text);\n  \n  // 1ë‹¨ê³„: ê¸°ë³¸ ë¬¸ì¥ ë¶„ë¦¬ (ë§ˆì¹¨í‘œ, ë¬¼ìŒí‘œ, ëŠë‚Œí‘œ)\n  const basicSentences = [];\n  let currentSentence = '';\n  \n  for (let i = 0; i < text.length; i++) {\n    const char = text[i];\n    const nextChar = text[i + 1];\n    const prevChar = text[i - 1];\n    \n    currentSentence += char;\n    \n    // ë¬¸ì¥ ì¢…ë£Œ í›„ë³´ ë°œê²¬\n    if (char === '.' || char === '!' || char === '?') {\n      \n      // ì•½ì–´/ì´ë‹ˆì…œ íŒ¨í„´ ì²´í¬ (ë” ì—„ê²©í•˜ê²Œ)\n      const isAbbreviation = checkIfAbbreviation(text, i, prevChar, nextChar);\n      \n      if (!isAbbreviation) {\n        // ì§„ì§œ ë¬¸ì¥ ëìœ¼ë¡œ íŒë‹¨\n        basicSentences.push(currentSentence.trim());\n        currentSentence = '';\n        console.log('âœ‚ï¸ ë¬¸ì¥ ë¶„ë¦¬:', basicSentences[basicSentences.length - 1]);\n      } else {\n        console.log('ğŸ”¤ ì•½ì–´ ê°ì§€, ë¶„ë¦¬í•˜ì§€ ì•ŠìŒ:', `\"${prevChar}${char}\"`);\n      }\n    }\n  }\n  \n  // ë§ˆì§€ë§‰ ë¬¸ì¥ ì¶”ê°€\n  if (currentSentence.trim()) {\n    basicSentences.push(currentSentence.trim());\n    console.log('ğŸ“ ë§ˆì§€ë§‰ ë¬¸ì¥ ì¶”ê°€:', currentSentence.trim());\n  }\n  \n  console.log(`ğŸ“Š ì´ ${basicSentences.length}ê°œ ë¬¸ì¥ ë¶„ë¦¬ ì™„ë£Œ`);\n  return basicSentences.filter(s => s.length > 0);\n}\n\n// ì•½ì–´/ì´ë‹ˆì…œ íŒë‹¨ í•¨ìˆ˜ (ë” ì—„ê²©í•˜ê²Œ ìˆ˜ì •)\nfunction checkIfAbbreviation(text, dotIndex, prevChar, nextChar) {\n  // 1. ë‹¨ì¼ ëŒ€ë¬¸ì + ë§ˆì¹¨í‘œ íŒ¨í„´ë§Œ ì•½ì–´ë¡œ ì¸ì • (ì˜ˆ: \"L.\")\n  if (prevChar && prevChar.match(/[A-Z]/) && nextChar === ' ') {\n    const wordBefore = getWordBefore(text, dotIndex - 1);\n    const nextWord = getNextWord(text, dotIndex + 1);\n    \n    // ë‹¨ì¼ ë¬¸ìì´ê³ , ë‹¤ìŒ ë‹¨ì–´ê°€ ì†Œë¬¸ìë‚˜ í•œê¸€ë¡œ ì‹œì‘í•˜ë©´ ì•½ì–´\n    if (wordBefore.length === 1 && nextWord && \n        (nextWord[0].match(/[a-zê°€-í£]/) || nextWord[0] === nextWord[0].toLowerCase())) {\n      console.log('ğŸ”¤ ë‹¨ì¼ ëŒ€ë¬¸ì ì•½ì–´ ê°ì§€:', `\"${wordBefore}.\" â†’ \"${nextWord}\"`);\n      return true;\n    }\n  }\n  \n  // 2. ìˆ«ì + % + ë‚˜ íŒ¨í„´ (ì˜ˆ: \"16%ë‚˜\")ì€ ì•½ì–´ê°€ ì•„ë‹˜\n  if (prevChar && prevChar.match(/[%ë‚˜ë‹¤ìŠµë‹ˆ]/)) {\n    return false;\n  }\n  \n  // 3. ì¼ë°˜ì ì¸ í•œêµ­ì–´ ì–´ë¯¸ëŠ” ì•½ì–´ê°€ ì•„ë‹˜\n  const wordBefore = getWordBefore(text, dotIndex - 1);\n  if (wordBefore.match(/ìŠµë‹ˆë‹¤|ë©ë‹ˆë‹¤|ì…ë‹ˆë‹¤$/)) {\n    return false;\n  }\n  \n  return false;\n}\n\n// ì´ì „ ë‹¨ì–´ ì¶”ì¶œ\nfunction getWordBefore(text, index) {\n  let word = '';\n  for (let i = index; i >= 0; i--) {\n    const char = text[i];\n    if (char === ' ') break;\n    word = char + word;\n  }\n  return word;\n}\n\n// ë‹¤ìŒ ë‹¨ì–´ ì¶”ì¶œ\nfunction getNextWord(text, startIndex) {\n  let word = '';\n  let foundStart = false;\n  \n  for (let i = startIndex; i < text.length; i++) {\n    const char = text[i];\n    \n    if (!foundStart && char === ' ') continue;\n    if (!foundStart && char !== ' ') foundStart = true;\n    \n    if (foundStart) {\n      if (char === ' ') break;\n      word += char;\n    }\n  }\n  \n  return word;\n}\n\n// ê°œì„ ëœ ë¬¸ì¥ ë¶„ë¦¬ ì‹¤í–‰\nconst sentences = smartSentenceSplit(fullText);\nconsole.log('ğŸ“‹ ë¶„ë¦¬ëœ ë¬¸ì¥ë“¤:');\nsentences.forEach((sentence, i) => {\n  console.log(`  ${i + 1}: \"${sentence}\"`);\n});\n\n// === 3ë‹¨ê³„: ê° ë¬¸ì¥ì— í•´ë‹¹í•˜ëŠ” ë‹¨ì–´ë“¤ ì°¾ê¸° ë° íƒ€ì´ë° ê³„ì‚° ===\nconsole.log('â±ï¸ ë¬¸ì¥ë³„ íƒ€ì´ë° ê³„ì‚°...');\n\nfunction findWordsForSentence(sentence, allWords, startIndex = 0) {\n  const sentenceWords = sentence.split(/\\s+/).filter(w => w.length > 0);\n  const matchedWords = [];\n  let wordIndex = startIndex;\n  let sentenceWordIndex = 0;\n  \n  console.log(`ğŸ” ë¬¸ì¥ ì²˜ë¦¬: \"${sentence}\"`);\n  console.log(`   ì°¾ì„ ë‹¨ì–´ë“¤: [${sentenceWords.join(', ')}]`);\n  \n  // ê° ë¬¸ì¥ì˜ ì²« ë²ˆì§¸ ë‹¨ì–´ë¶€í„° ë§ˆì§€ë§‰ ë‹¨ì–´ê¹Œì§€ ìˆœì°¨ì ìœ¼ë¡œ ì°¾ê¸°\n  while (wordIndex < allWords.length && sentenceWordIndex < sentenceWords.length) {\n    const currentWord = allWords[wordIndex].word.trim();\n    const targetWord = sentenceWords[sentenceWordIndex];\n    \n    // ë‹¨ì–´ê°€ ë§¤ì¹­ë˜ëŠ”ì§€ í™•ì¸ (ë¶€ë¶„ ë§¤ì¹­ í—ˆìš©)\n    if (currentWord.includes(targetWord) || targetWord.includes(currentWord) || \n        currentWord.replace(/[.,!?]/g, '') === targetWord.replace(/[.,!?]/g, '')) {\n      matchedWords.push(allWords[wordIndex]);\n      console.log(`   âœ… ë§¤ì¹­: \"${targetWord}\" = \"${currentWord}\" (${allWords[wordIndex].start.toFixed(2)}s)`);\n      sentenceWordIndex++;\n    } else {\n      console.log(`   â­ï¸ ìŠ¤í‚µ: \"${currentWord}\" (${allWords[wordIndex].start.toFixed(2)}s)`);\n    }\n    wordIndex++;\n  }\n  \n  console.log(`   ê²°ê³¼: ${matchedWords.length}/${sentenceWords.length} ë‹¨ì–´ ë§¤ì¹­`);\n  \n  return { matchedWords, nextStartIndex: wordIndex };\n}\n\n// ë¬¸ì¥ë³„ ì„¸ê·¸ë¨¼íŠ¸ ìƒì„±\nconst sentenceSegments = [];\nlet currentWordIndex = 0;\n\nsentences.forEach((sentence, index) => {\n  console.log(`ğŸ” ë¬¸ì¥ ${index + 1} ì²˜ë¦¬ ì¤‘: \"${sentence}\"`);\n  \n  // ì´ ë¬¸ì¥ì— í•´ë‹¹í•˜ëŠ” ë‹¨ì–´ë“¤ ì°¾ê¸°\n  const result = findWordsForSentence(sentence, words, currentWordIndex);\n  const sentenceWords = result.matchedWords;\n  currentWordIndex = result.nextStartIndex;\n  \n  if (sentenceWords.length > 0) {\n    const startTime = sentenceWords[0].start;\n    const endTime = sentenceWords[sentenceWords.length - 1].end;\n    \n    sentenceSegments.push({\n      segmentId: index,\n      startTime: startTime,\n      endTime: endTime,\n      duration: endTime - startTime,\n      text: sentence,\n      words: sentenceWords.map(word => ({\n        word: word.word.trim(),\n        start: word.start,\n        end: word.end,\n        duration: word.end - word.start,\n        confidence: 0.8,\n        segmentId: index\n      })),\n      wordCount: sentenceWords.length\n    });\n    \n    console.log(`âœ… ë¬¸ì¥ ${index + 1}: ${startTime.toFixed(2)}s ~ ${endTime.toFixed(2)}s (${sentenceWords.length}ê°œ ë‹¨ì–´)`);\n  } else {\n    console.log(`âš ï¸ ë¬¸ì¥ ${index + 1}: ë§¤ì¹­ë˜ëŠ” ë‹¨ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);\n  }\n});\n\n// === 4ë‹¨ê³„: 6ê°œ ë¬¸ì¥ìœ¼ë¡œ ì œí•œ ë° ì—°ì† íƒ€ì´ë° ì¡°ì • ===\nconst tempSegments = sentenceSegments.slice(0, 6);\n\n// ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ì—°ì†ì ìœ¼ë¡œ ì—°ê²°\nconst finalSegments = [];\n\nfor (let index = 0; index < tempSegments.length; index++) {\n  const segment = tempSegments[index];\n  let startTime, endTime;\n  \n  if (index === 0) {\n    // ì²« ë²ˆì§¸ ì„¸ê·¸ë¨¼íŠ¸: 0ì´ˆë¶€í„° ì‹œì‘\n    startTime = 0;\n  } else {\n    // ì´í›„ ì„¸ê·¸ë¨¼íŠ¸ë“¤: ì´ì „ ì„¸ê·¸ë¨¼íŠ¸ ëì‹œê°„ë¶€í„° ì‹œì‘\n    startTime = finalSegments[index - 1].endTime;\n  }\n  \n  if (index === tempSegments.length - 1) {\n    // ë§ˆì§€ë§‰ ì„¸ê·¸ë¨¼íŠ¸: ì›ë˜ ëì‹œê°„ ìœ ì§€\n    endTime = segment.endTime;\n  } else {\n    // ì´í›„ ì„¸ê·¸ë¨¼íŠ¸ë“¤: ë‹¤ìŒ ë¬¸ì¥ì˜ ì‹œì‘ì‹œê°„ê¹Œì§€\n    endTime = tempSegments[index + 1].startTime;\n  }\n  \n  finalSegments.push({\n    segmentId: index,\n    startTime: startTime,\n    endTime: endTime,\n    duration: endTime - startTime,\n    text: segment.text,\n    originalId: index\n  });\n}\n\nconsole.log(`ğŸ“Š ìµœì¢… ì„¸ê·¸ë¨¼íŠ¸: ${finalSegments.length}ê°œ`);\nfinalSegments.forEach((seg, i) => {\n  console.log(`  ì„¸ê·¸ë¨¼íŠ¸ ${i}: \"${seg.text}\" (${seg.startTime.toFixed(2)}s ~ ${seg.endTime.toFixed(2)}s)`);\n});\n\n// === 5ë‹¨ê³„: ì„¸ê·¸ë¨¼íŠ¸ë³„ ë‹¨ì–´ ê·¸ë£¹í•‘ (ì—°ì† íƒ€ì´ë° ì ìš©) ===\nconsole.log('ğŸ”¤ ì„¸ê·¸ë¨¼íŠ¸ë³„ ë‹¨ì–´ ê·¸ë£¹í•‘ (ì—°ì† íƒ€ì´ë°)...');\n\nconst wordsGroupedBySegment = finalSegments.map((segment, index) => {\n  // ì›ë³¸ ë¬¸ì¥ì—ì„œ í•´ë‹¹í•˜ëŠ” ë‹¨ì–´ë“¤ ê°€ì ¸ì˜¤ê¸°\n  const originalSegment = tempSegments[index];\n  \n  return {\n    segmentId: index,\n    segmentText: segment.text,\n    startTime: segment.startTime,\n    endTime: segment.endTime,\n    words: originalSegment ? originalSegment.words : [],\n    totalWords: originalSegment ? originalSegment.wordCount : 0\n  };\n});\n\n// === 6ë‹¨ê³„: ì „ì²´ ë‹¨ì–´ ë¦¬ìŠ¤íŠ¸ ìƒì„± (ì• ë‹ˆë©”ì´ì…˜ìš©) ===\nconsole.log('ğŸ­ ì• ë‹ˆë©”ì´ì…˜ìš© ë‹¨ì–´ ë¦¬ìŠ¤íŠ¸ ìƒì„±...');\n\nconst allWordsForAnimation = [];\nwordsGroupedBySegment.forEach(segment => {\n  segment.words.forEach(word => {\n    allWordsForAnimation.push(word);\n  });\n});\n\n// ì²« ë²ˆì§¸ ë£¨í”„ë§Œ í•„í„°ë§\nconst firstLoopEndTime = finalSegments[finalSegments.length - 1]?.endTime || 40;\nconst filteredWords = allWordsForAnimation.filter(word => word.start <= firstLoopEndTime);\n\nconsole.log(`ğŸ“Š ë‹¨ì–´ í•„í„°ë§: ${allWordsForAnimation.length} â†’ ${filteredWords.length} ë‹¨ì–´`);\n\n// === 7ë‹¨ê³„: ASS ì• ë‹ˆë©”ì´ì…˜ ìë§‰ ìƒì„± ===\nconsole.log('âš¡ ASS ì• ë‹ˆë©”ì´ì…˜ ìë§‰ ìƒì„±...');\n\nfunction generateEnhancedASS(words) {\n  const assHeader = `[Script Info]\nTitle: Netflix AI News - Enhanced Electric Blue\nScriptType: v4.00+\n\n[V4+ Styles]\nFormat: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding\nStyle: ElectricGlow,Montserrat,22,&Hffffff,&Hffffff,&H00FF8000,&H80000000,1,0,0,0,100,100,0,0,1,4,6,5,50,50,960,1\nStyle: PunchEffect,Montserrat,22,&Hffffff,&Hffffff,&H00FF8000,&H80000000,1,0,0,0,100,100,0,0,1,4,6,5,50,50,960,1\n\n[Events]\nFormat: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text\n`;\n\n  let assEvents = '';\n  \n  words.forEach((word, index) => {\n    const startTime = formatTimeForASS(word.start * 1000);\n    const endTime = formatTimeForASS(word.end * 1000);\n    \n    // êµëŒ€ë¡œ ë‹¤ë¥¸ ì• ë‹ˆë©”ì´ì…˜ ì ìš©\n    const useGlowEffect = index % 2 === 0;\n    \n    if (useGlowEffect) {\n      const animation = `{\\\\fad(300,200)\\\\t(0,300,\\\\fscx110\\\\fscy110\\\\3c&H00FF8000&\\\\bord5)\\\\t(300,600,\\\\fscx100\\\\fscy100\\\\3c&H00CC6000&\\\\bord4)\\\\t(600,900,\\\\3c&H00FF8000&\\\\bord5)}`;\n      assEvents += `Dialogue: 0,${startTime},${endTime},ElectricGlow,,0,0,0,,${animation}${word.word}\\n`;\n    } else {\n      const animation = `{\\\\fad(200,200)\\\\t(0,200,\\\\fscx120\\\\fscy120\\\\frz3\\\\3c&H00FF8000&\\\\bord6)\\\\t(200,400,\\\\fscx100\\\\fscy100\\\\frz0\\\\3c&H00CC6000&\\\\bord4)\\\\t(400,600,\\\\3c&H00FF8000&\\\\bord5)}`;\n      assEvents += `Dialogue: 0,${startTime},${endTime},PunchEffect,,0,0,0,,${animation}${word.word}\\n`;\n    }\n  });\n  \n  return assHeader + assEvents;\n}\n\n// ASS ì‹œê°„ í˜•ì‹ ë³€í™˜\nfunction formatTimeForASS(ms) {\n  const hours = Math.floor(ms / 3600000);\n  const minutes = Math.floor((ms % 3600000) / 60000);\n  const seconds = Math.floor((ms % 60000) / 1000);\n  const centiseconds = Math.floor((ms % 1000) / 10);\n  \n  return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${centiseconds.toString().padStart(2, '0')}`;\n}\n\n// SRT í˜•ì‹ ìƒì„±\nfunction generateSRT(words) {\n  let srtContent = '';\n  \n  words.forEach((word, index) => {\n    const startTime = formatSecondsToSRT(word.start);\n    const endTime = formatSecondsToSRT(word.end);\n    \n    srtContent += `${index + 1}\\n`;\n    srtContent += `${startTime} --> ${endTime}\\n`;\n    srtContent += `${word.word}\\n\\n`;\n  });\n  \n  return srtContent.trim();\n}\n\n// SRT ì‹œê°„ í˜•ì‹ ë³€í™˜\nfunction formatSecondsToSRT(seconds) {\n  const hours = Math.floor(seconds / 3600);\n  const minutes = Math.floor((seconds % 3600) / 60);\n  const secs = Math.floor(seconds % 60);\n  const ms = Math.floor((seconds % 1) * 1000);\n  \n  return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')},${ms.toString().padStart(3, '0')}`;\n}\n\n// WebVTT í˜•ì‹ ìƒì„±\nfunction generateWebVTT(words) {\n  let webVttContent = 'WEBVTT\\n\\n';\n  \n  words.forEach((word, index) => {\n    const startTime = formatSecondsToWebVTT(word.start);\n    const endTime = formatSecondsToWebVTT(word.end);\n    \n    webVttContent += `${index + 1}\\n`;\n    webVttContent += `${startTime} --> ${endTime}\\n`;\n    webVttContent += `${word.word}\\n\\n`;\n  });\n  \n  return webVttContent.trim();\n}\n\n// WebVTT ì‹œê°„ í˜•ì‹ ë³€í™˜\nfunction formatSecondsToWebVTT(seconds) {\n  const hours = Math.floor(seconds / 3600);\n  const minutes = Math.floor((seconds % 3600) / 60);\n  const secs = seconds % 60;\n  \n  return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toFixed(3).padStart(6, '0')}`;\n}\n\n// === 8ë‹¨ê³„: ìë§‰ íŒŒì¼ ìƒì„± ===\nconst assContent = generateEnhancedASS(filteredWords);\nconst srtContent = generateSRT(filteredWords);\nconst webVttContent = generateWebVTT(filteredWords);\n\n// === 9ë‹¨ê³„: í†µê³„ ìƒì„± ===\nconst statistics = {\n  totalWords: filteredWords.length,\n  totalDuration: firstLoopEndTime,\n  averageWordDuration: filteredWords.length > 0 ? filteredWords.reduce((sum, w) => sum + w.duration, 0) / filteredWords.length : 0,\n  wordsPerSegment: wordsGroupedBySegment.map(s => s.totalWords),\n  segmentCount: finalSegments.length,\n  sentencesProcessed: sentences.length,\n  method: \"sentence_based_continuous_segmentation_with_abbreviation_handling\"\n};\n\nconsole.log('ğŸ“Š ìµœì¢… í†µê³„:', statistics);\n\n// === ìµœì¢… ì¶œë ¥ ë°ì´í„° ===\nconst outputData = {\n  // 6sentences í˜¸í™˜ ë°ì´í„° (ë¬¸ì¥ ë‹¨ìœ„ ì—°ì†)\n  totalSegments: finalSegments.length,\n  totalDuration: firstLoopEndTime,\n  segmentTimings: finalSegments,\n  \n  // Word Subtitle ë°ì´í„°\n  wordSubtitles: wordsGroupedBySegment,\n  allWords: filteredWords,\n  \n  // ìë§‰ íŒŒì¼ë“¤\n  subtitleFiles: {\n    ass: {\n      content: assContent,\n      filename: \"ASS_subtitle.ass\"\n    },\n    srt: {\n      content: srtContent,\n      filename: \"word_subtitles.srt\"\n    },\n    webvtt: {\n      content: webVttContent,\n      filename: \"word_subtitles.vtt\"\n    }\n  },\n  \n  // í†µê³„ ë° ë©”íƒ€ë°ì´í„°\n  statistics: statistics,\n  processingInfo: {\n    processedAt: new Date().toISOString(),\n    method: \"sentence_based_continuous_whisper_processor_v4_with_abbreviation_fix\",\n    whisperFormat: \"segments_and_words\",\n    segmentationMethod: \"sentence_based_continuous_smart_split\",\n    animationStyle: \"electric_blue_enhanced\",\n    ready: true\n  }\n};\n\nconsole.log('âœ… ì™„ì „í•œ ë¬¸ì¥ ê¸°ë°˜ Whisper ì²˜ë¦¬ ì™„ë£Œ! (ì•½ì–´ ì²˜ë¦¬ ê°œì„ )');\nconsole.log(`ğŸ“ ${statistics.segmentCount}ê°œ ì—°ì† ë¬¸ì¥ ì„¸ê·¸ë¨¼íŠ¸, ${statistics.totalWords}ê°œ ë‹¨ì–´`);\nconsole.log(`âš¡ ASS ì• ë‹ˆë©”ì´ì…˜ ìë§‰ ìƒì„± ì™„ë£Œ`);\nconsole.log(`ğŸ”§ ì•½ì–´/ì´ë‹ˆì…œ ì²˜ë¦¬ ê¸°ëŠ¥ ì¶”ê°€ë¨`);\n\nreturn [{ json: outputData }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        180,
        -1000
      ],
      "id": "gen_ass_subtitles",
      "name": "Generate ASS Subtitles"
    },
    {
      "parameters": {
        "jsCode": "// === ìˆ˜ì •ëœ Data Aggregator - ì—°ì† íƒ€ì´ë° ì ìš© (ë¡œê³  íŒŒì¼ ì²˜ë¦¬ ìˆ˜ì •) ===\n\nconsole.log('ğŸ“Š Data Aggregator ì‹œì‘ (ì—°ì† íƒ€ì´ë° ìˆ˜ì • ë²„ì „)');\n\nconst inputItems = $input.all();\nconsole.log(`ğŸ“¥ ì…ë ¥ ë°ì´í„°: ${inputItems.length}ê°œ`);\n\n// === ë°ì´í„° ë¶„ë¥˜ ë° ìˆ˜ì§‘ ===\nlet videoFiles = [];\nlet imageFiles = [];\nlet narrationAudio = null;\nlet wordSubtitleData = null;\nlet backgroundMusic = null;\nlet logoData = null;\n\n// ê° ì…ë ¥ ë°ì´í„° ì²˜ë¦¬\ninputItems.forEach((item, index) => {\n  const data = item.json;\n  \n  console.log(`ğŸ“‹ ì…ë ¥ ${index}: ${data.name || 'unnamed'} (${data.mimeType || data.kind || 'unknown'})`);\n  \n  // ë¹„ë””ì˜¤ íŒŒì¼ (ë¡œê³ ê°€ ì•„ë‹Œ ê²½ìš°)\n  if (data.mimeType === 'video/mp4' && !data.webViewLink && !data.name.toLowerCase().includes('logo')) {\n    videoFiles.push({\n      kind: \"drive#file\",\n      id: data.id,\n      name: data.name,\n      mimeType: data.mimeType,\n      source: `input[${index}]`\n    });\n    console.log(`  âœ… ë¹„ë””ì˜¤ íŒŒì¼ ì¶”ê°€: ${data.name}`);\n  }\n  \n // ì´ë¯¸ì§€ íŒŒì¼ (JPEGì™€ PNG ëª¨ë‘ ì²˜ë¦¬)\nelse if (data.mimeType === 'image/jpeg' || data.mimeType === 'image/png') {\n  imageFiles.push({\n    kind: \"drive#file\",\n    id: data.id,\n    name: data.name,\n    mimeType: data.mimeType,\n    source: `input[${index}]`\n  });\n  console.log(`  âœ… ì´ë¯¸ì§€ íŒŒì¼ ì¶”ê°€: ${data.name} (${data.mimeType})`);\n}\n  \n  // ë‚˜ë ˆì´ì…˜ ì˜¤ë””ì˜¤ (webViewLink ë˜ëŠ” webContentLink ìˆëŠ” ì˜¤ë””ì˜¤)\n  else if ((data.mimeType === 'audio/mpeg' || data.mimeType === 'audio/mp3') && \n           (data.webViewLink || data.webContentLink)) {\n    \n    let audioUrl = data.webContentLink || \n                   data.webViewLink.replace('/view?usp=drivesdk', '/export=download');\n    \n    narrationAudio = {\n      kind: \"drive#file\",\n      id: data.id,\n      name: data.name,\n      mimeType: data.mimeType,\n      url: audioUrl,\n      originalName: data.name,\n      processingInfo: {\n        source: \"audio_download_node\",\n        dynamicName: \"static\",\n        ready: true\n      }\n    };\n    console.log(`  âœ… ë‚˜ë ˆì´ì…˜ ì˜¤ë””ì˜¤: ${data.name} (MIME: ${data.mimeType})`);\n  }\n  \n  // ìë§‰ ë°ì´í„° (segmentTimings ìˆëŠ” ê°ì²´)\n  else if (data.segmentTimings && data.wordSubtitles && data.subtitleFiles) {\n    wordSubtitleData = data;\n    console.log(`  âœ… ìë§‰ ë°ì´í„°: ${data.totalSegments}ê°œ ì„¸ê·¸ë¨¼íŠ¸, ASS í¬í•¨`);\n  }\n  \n  // BGM ë°ì´í„° (kind === 'bgm')\n  else if (data.kind === 'bgm') {\n    backgroundMusic = {\n      kind: data.kind,\n      id: data.id,\n      name: data.name,\n      mimeType: data.mimeType,\n      style: data.style,\n      energy: data.energy,\n      volume: 0.15, // ê³ ì • 15%\n      url: `https://drive.google.com/uc?id=${data.id}&export=download`\n    };\n    console.log(`  âœ… BGM: ${data.name} (15%)`);\n  }\n  \n  // ë¡œê³  ë°ì´í„° (webViewLink ìˆëŠ” ë¹„ë””ì˜¤ ë˜ëŠ” ì´ë¦„ì— logoê°€ í¬í•¨ëœ ë¹„ë””ì˜¤)\n  else if (data.mimeType === 'video/mp4' && (data.webViewLink || data.name.toLowerCase().includes('logo'))) {\n    logoData = {\n      kind: \"drive#file\",\n      id: data.id,\n      name: data.name,\n      mimeType: data.mimeType,\n      url: data.webViewLink ? data.webViewLink.replace('/view?usp=drivesdk', '/export=download') : \n            `https://drive.google.com/file/d/${data.id}/export=download`\n    };\n    console.log(`  âœ… ë¡œê³ : ${data.name}`);\n  }\n  \n  else {\n    console.log(`  âš ï¸ ë¯¸ë¶„ë¥˜ ë°ì´í„°: ${data.name || 'unnamed'}`);\n  }\n});\n\n// === ğŸ”§ ìˆ˜ì •ëœ matchedSegments ìƒì„± ===\nfunction createMatchedSegments() {\n  if (!wordSubtitleData || !wordSubtitleData.segmentTimings) {\n    console.log('âŒ ìë§‰ ë°ì´í„° ì—†ìŒ - matchedSegments ìƒì„± ë¶ˆê°€');\n    return [];\n  }\n  \n  const segments = [];\n  const originalTimings = wordSubtitleData.segmentTimings;\n  \n  console.log('ğŸ”§ matchedSegments ìƒì„± ì¤‘...');\n  console.log('ğŸ“ ì›ë³¸ ìë§‰ íƒ€ì´ë°:');\n  originalTimings.forEach((timing, i) => {\n    console.log(`  ì„¸ê·¸ë¨¼íŠ¸ ${i}: ${timing.startTime.toFixed(2)}~${timing.endTime.toFixed(2)}ì´ˆ (${timing.duration.toFixed(2)}ì´ˆ)`);\n  });\n  \n  // ğŸ†• íŒŒì¼ëª…ì—ì„œ ìˆ«ì ì¶”ì¶œí•˜ëŠ” í•¨ìˆ˜ (ìˆ˜ì •ë¨)\n  function extractNumber(filename) {\n    // íŒŒì¼ëª…ì—ì„œ _XX_ íŒ¨í„´ì˜ ìˆ«ì ì¶”ì¶œ (ì˜ˆ: \"YYYY08Aug 5, 2025_01_video1.mp4\" â†’ 1)\n    const match = filename.match(/_(\\d+)_/);\n    if (match) {\n      return parseInt(match[1], 10);\n    }\n    // ìˆ«ìê°€ ì—†ìœ¼ë©´ 100 ë°˜í™˜ (999ëŠ” ë„ˆë¬´ í° ê°’ì´ë¼ ë¬¸ì œ ë°œìƒ)\n    return 100;\n  }\n  \n  // ğŸ¯ ë¹„ë””ì˜¤ì™€ ì´ë¯¸ì§€ íŒŒì¼ ì •ë ¬\n  const sortedVideoFiles = videoFiles.sort((a, b) => {\n    const numA = extractNumber(a.name);\n    const numB = extractNumber(b.name);\n    console.log(`  ë¹„êµ: ${a.name}(${numA}) vs ${b.name}(${numB})`);\n    return numA - numB;\n  });\n\n  const sortedImageFiles = imageFiles.sort((a, b) => {\n    const numA = extractNumber(a.name);\n    const numB = extractNumber(b.name);\n    console.log(`  ë¹„êµ: ${a.name}(${numA}) vs ${b.name}(${numB})`);\n    return numA - numB;\n  });\n\n  // ë¹„ë””ì˜¤ë¥¼ ë¨¼ì € ë°°ì¹˜í•˜ê³ , ê·¸ ë‹¤ìŒì— ì´ë¯¸ì§€ ë°°ì¹˜\n  const allMediaFiles = [...sortedVideoFiles, ...sortedImageFiles];\n  \n  console.log('ğŸ“ ë„˜ë²„ë§ + ë¹„ë””ì˜¤ ìš°ì„ ìˆœìœ„ë¡œ ì •ë ¬ëœ ë¯¸ë””ì–´ íŒŒì¼:');\n  allMediaFiles.forEach((file, i) => {\n    const num = extractNumber(file.name);\n    const type = file.mimeType === 'video/mp4' ? 'VIDEO' : 'IMAGE';\n    console.log(`  ì„¸ê·¸ë¨¼íŠ¸ ${i}: ${file.name} (ë²ˆí˜¸: ${num}, íƒ€ì…: ${type})`);\n  });\n  \n  // ì„¸ê·¸ë¨¼íŠ¸ 0~5: ì •ë ¬ëœ ë¹„ë””ì˜¤ì™€ ì´ë¯¸ì§€ë¥¼ ìˆœì„œëŒ€ë¡œ ë°°ì¹˜\n  originalTimings.forEach((originalTiming, i) => {\n    if (i < allMediaFiles.length) {\n      const mediaFile = allMediaFiles[i];\n      const isVideo = mediaFile.mimeType === 'video/mp4';\n      \n      const segment = {\n        segmentId: i,\n        type: isVideo ? \"generated_video\" : \"generated_image\",\n        id: mediaFile.id,\n        name: mediaFile.name,\n        mimeType: mediaFile.mimeType,\n        url: `https://drive.google.com/uc?id=${mediaFile.id}&export=download`,\n        source: mediaFile.source,\n        timing: {\n          startTime: originalTiming.startTime,\n          endTime: originalTiming.endTime,\n          duration: originalTiming.duration\n        },\n        text: originalTiming.text\n      };\n      \n      segments.push(segment);\n      console.log(`  âœ… ì„¸ê·¸ë¨¼íŠ¸ ${i} ìƒì„±: ${mediaFile.name}`);\n    }\n  });\n  \n  // ìë§‰ ê¸°ì¤€ ì´ ì‹œê°„ (ì›ë³¸ ìë§‰ì˜ ë§ˆì§€ë§‰ ì„¸ê·¸ë¨¼íŠ¸ ë ì‹œê°„)\n  const lastSegmentEndTime = Math.max(...originalTimings.map(t => t.endTime));\n  const subtitleTotalDuration = lastSegmentEndTime;\n  \n  // ğŸ¯ ì„¸ê·¸ë¨¼íŠ¸ 6: ë¡œê³  (D+1ì´ˆ~D+2ì´ˆ)\n  if (logoData) {\n    const logoStartTime = subtitleTotalDuration + 1;  // D+1ì´ˆ\n    const logoEndTime = logoStartTime + 1.0;          // D+2ì´ˆ (1ì´ˆ ê¸¸ì´)\n    \n    const logoSegment = {\n      segmentId: 6,\n      type: \"animated_logo\",\n      id: logoData.id,\n      name: logoData.name,\n      mimeType: logoData.mimeType,\n      url: logoData.url,\n      source: \"logo\",\n      timing: {\n        startTime: logoStartTime,\n        endTime: logoEndTime,\n        duration: 1.0\n      },\n      text: \"ë¡œê³  ì• ë‹ˆë©”ì´ì…˜ (ì¬ìƒ í›„ ì •ì§€)\"\n    };\n    \n    segments.push(logoSegment);\n    console.log(`  âœ… ë¡œê³  ì„¸ê·¸ë¨¼íŠ¸ 6 ìƒì„±: ${logoData.name}`);\n  }\n  \n  // === ğŸ¯ íƒ€ì´ë° ì¡°ì • ë¡œì§ (ê°€ì´ë“œ ì ìš©) ===\n  const adjustedMatchedSegments = segments.map((seg) => ({ ...seg }));\n  \n  // 1. ì„¸ê·¸ë¨¼íŠ¸ 0ì˜ ì‹œì‘ ì‹œê°„ì€ í•­ìƒ 0ìœ¼ë¡œ ê³ ì •\n  if (adjustedMatchedSegments.length > 0) {\n    adjustedMatchedSegments[0].timing.startTime = 0;\n  }\n  \n  // 2. ì´í›„ ì„¸ê·¸ë¨¼íŠ¸ë“¤ì˜ ì‹œì‘ì‹œê°„ì€ ìë§‰ì—ì„œ ë°›ì•„ì˜¨ ê°’ ì‚¬ìš©\n  for (let i = 1; i < adjustedMatchedSegments.length; i++) {\n    if (adjustedMatchedSegments[i].segmentId < 6) {\n      // ì„¸ê·¸ë¨¼íŠ¸ 1~5ëŠ” ì›ë³¸ ìë§‰ ì‹œê°„ ìœ ì§€\n      adjustedMatchedSegments[i].timing.startTime = segments[i].timing.startTime;\n    }\n    // ì„¸ê·¸ë¨¼íŠ¸ 6 (ë¡œê³ )ëŠ” ì´ë¯¸ ì˜¬ë°”ë¥¸ ì‹œê°„ìœ¼ë¡œ ì„¤ì •ë¨\n  }\n  \n  // 3. ëª¨ë“  ì„¸ê·¸ë¨¼íŠ¸ì˜ endTimeê³¼ duration ê³„ì‚° (ë‹¤ìŒ ì„¸ê·¸ë¨¼íŠ¸ì˜ startTime ê¸°ì¤€)\n  for (let i = 0; i < adjustedMatchedSegments.length - 1; i++) {\n    const start = adjustedMatchedSegments[i].timing.startTime;\n    const nextStart = adjustedMatchedSegments[i + 1].timing.startTime;\n    adjustedMatchedSegments[i].timing.endTime = nextStart;\n    adjustedMatchedSegments[i].timing.duration = parseFloat((nextStart - start).toFixed(6));\n  }\n  \n  // 4. ë§ˆì§€ë§‰ ì„¸ê·¸ë¨¼íŠ¸ (ë¡œê³ )ì˜ durationì€ 1ì´ˆ ê³ ì •, endTimeë„ ì„¤ì •\n  if (adjustedMatchedSegments.length > 0) {\n    const last = adjustedMatchedSegments[adjustedMatchedSegments.length - 1];\n    last.timing.endTime = parseFloat((last.timing.startTime + 1.0).toFixed(6));\n    last.timing.duration = 1.0;\n  }\n  \n  console.log('\\nğŸ”§ íƒ€ì´ë° ì¡°ì • ì™„ë£Œ:');\n  adjustedMatchedSegments.forEach((seg, i) => {\n    console.log(`  ì„¸ê·¸ë¨¼íŠ¸ ${seg.segmentId}: ${seg.timing.startTime.toFixed(6)}~${seg.timing.endTime.toFixed(6)}ì´ˆ (${seg.timing.duration.toFixed(6)}ì´ˆ) - ${seg.name}`);\n  });\n  \n  console.log(`\\nâœ… matchedSegments ìƒì„± ì™„ë£Œ: ${adjustedMatchedSegments.length}ê°œ`);\n  return adjustedMatchedSegments;\n}\n\nconst matchedSegments = createMatchedSegments();\n\n// === ìµœì¢… ê²°ê³¼ ìƒì„± ===\nconst result = {\n  // ë¯¸ë””ì–´ íŒŒì¼ë“¤\n  videoSegments: videoFiles,\n  imageSegments: imageFiles,\n  allSegments: [...videoFiles, ...imageFiles],\n  \n  // ğŸ”— í•µì‹¬: ì¡°ì •ëœ íƒ€ì´ë°ì´ ì ìš©ëœ matchedSegments\n  matchedSegments: matchedSegments,\n  \n  // ğŸ§ ë‚˜ë ˆì´ì…˜ ì˜¤ë””ì˜¤\n  narrationAudio: narrationAudio,\n  \n  // ğŸ­ ìë§‰ ë°ì´í„° (ì›ë³¸ ìœ ì§€)\n  wordSubtitleData: wordSubtitleData,\n  \n  // ğŸµ BGM ë°ì´í„°\n  backgroundMusic: backgroundMusic,\n  availableMusic: backgroundMusic ? [backgroundMusic] : [],\n  \n  // ğŸ¯ ë¡œê³  ë°ì´í„°\n  animatedLogo: logoData,\n  \n  // ê¸°íƒ€ ì •ë³´\n  videoContent: {},\n  segmentMap: [],\n  totalSegments: videoFiles.length + imageFiles.length + (logoData ? 1 : 0),\n  \n  // êµ¬ì„± ì •ë³´\n  composition: {\n    videos: videoFiles.length,\n    images: imageFiles.length,\n    logo: logoData ? 1 : 0,\n    pattern: `V${videoFiles.length}I${imageFiles.length}${logoData ? 'L1' : ''}`,\n    hasNarration: !!narrationAudio,\n    hasBGM: !!backgroundMusic,\n    hasLogo: !!logoData,\n    hasSubtitles: !!wordSubtitleData\n  },\n  \n  // ìë§‰ ì •ë³´\n  subtitleInfo: {\n    hasBasicSubtitle: false,\n    hasWordSubtitle: !!wordSubtitleData,\n    preferredSubtitle: \"word\",\n    subtitleType: wordSubtitleData ? \"ë‹¨ì–´ë³„ ìë§‰\" : \"ìë§‰ ì—†ìŒ\",\n    wordCount: wordSubtitleData?.statistics?.totalWords || 0\n  },\n  \n  // ë¡œê³  ì •ë³´\n  logoInfo: {\n    hasAnimatedLogo: !!logoData,\n    logoType: logoData ? \"ì• ë‹ˆë©”ì´ì…˜ ë¡œê³  (ì„¸ê·¸ë¨¼íŠ¸ 6)\" : \"ë¡œê³  ì—†ìŒ\",\n    logoDuration: logoData ? 1 : 0,\n    logoPosition: logoData ? \"D+1ì´ˆ~D+2ì´ˆ (ì¬ìƒ í›„ ì •ì§€)\" : \"ì—†ìŒ\"\n  },\n  \n  // ìŒì•… ì •ë³´\n  musicInfo: {\n    hasBGM: !!backgroundMusic,\n    musicStyle: backgroundMusic?.style || \"ì—†ìŒ\",\n    musicEnergy: backgroundMusic?.energy || \"ì—†ìŒ\",\n    volume: backgroundMusic?.volume || 0,\n    availableOptions: backgroundMusic ? 1 : 0\n  },\n  \n  // ê²€ì¦ ì •ë³´\n  validation: {\n    hasNarration: !!narrationAudio,\n    hasSubtitle: false,\n    hasWordSubtitle: !!wordSubtitleData,\n    hasAnimatedLogo: !!logoData,\n    hasBGM: !!backgroundMusic,\n    hasVideoSegments: videoFiles.length > 0,\n    hasImageSegments: imageFiles.length > 0,\n    totalSegments: videoFiles.length + imageFiles.length + (logoData ? 1 : 0),\n    segmentIdsContinuous: true,\n    hasSixSentencesData: false,\n    hasFullVideoText: false,\n    hasMatchedSegments: matchedSegments.length > 0\n  },\n  \n  // ì²˜ë¦¬ ì¤€ë¹„ ìƒíƒœ\n  readyForTimingParsing: !!wordSubtitleData && (videoFiles.length > 0 || imageFiles.length > 0),\n  dataComplete: !!wordSubtitleData && !!narrationAudio && !!backgroundMusic && matchedSegments.length > 0,\n  readyForAnimatedProcessing: !!wordSubtitleData,\n  readyForLogoProcessing: !!logoData,\n  readyForVideoComposition: matchedSegments.length > 0 && !!narrationAudio && !!backgroundMusic,\n  \n  // ì²˜ë¦¬ ì •ë³´\n  processingTimestamp: new Date().toISOString(),\n  processingInfo: {\n    method: \"adjusted_timing_aggregator_v1\",\n    totalInputsProcessed: inputItems.length,\n    dataSourcesFound: [\n      videoFiles.length > 0 ? \"video_files\" : null,\n      imageFiles.length > 0 ? \"image_files\" : null,\n      narrationAudio ? \"narration_audio\" : null,\n      wordSubtitleData ? \"word_subtitle_data\" : null,\n      backgroundMusic ? \"background_music\" : null,\n      logoData ? \"logo_data\" : null\n    ].filter(Boolean),\n    matchedSegmentsGenerated: matchedSegments.length > 0,\n    timingMethod: \"segment_0_zero_start_others_continuous\",\n    ready: true\n  }\n};\n\n// ìµœì¢… ë¡œê·¸\nconsole.log('\\nâœ… ì¡°ì •ëœ íƒ€ì´ë° Data Aggregator ì™„ë£Œ:');\nconsole.log(`  ğŸ“¹ ë¹„ë””ì˜¤: ${videoFiles.length}ê°œ`);\nconsole.log(`  ğŸ–¼ï¸ ì´ë¯¸ì§€: ${imageFiles.length}ê°œ`);\nconsole.log(`  ğŸ§ ë‚˜ë ˆì´ì…˜: ${narrationAudio ? 'ìˆìŒ' : 'ì—†ìŒ'}`);\nconsole.log(`  ğŸµ BGM: ${backgroundMusic ? 'ìˆìŒ' : 'ì—†ìŒ'}`);\nconsole.log(`  ğŸ¯ ë¡œê³ : ${logoData ? 'ìˆìŒ' : 'ì—†ìŒ'}`);\nconsole.log(`  ğŸ­ ìë§‰: ${wordSubtitleData ? 'ìˆìŒ (ì›ë³¸ ìœ ì§€)' : 'ì—†ìŒ'}`);\nconsole.log(`  ğŸ”— matchedSegments: ${matchedSegments.length}ê°œ`);\nif (matchedSegments.length > 0) {\n  console.log(`  â° ì„¸ê·¸ë¨¼íŠ¸ 0: ${matchedSegments[0].timing.startTime}~${matchedSegments[0].timing.endTime.toFixed(6)}ì´ˆ`);\n  if (matchedSegments.length > 1) {\n    console.log(`  â° ì„¸ê·¸ë¨¼íŠ¸ 1: ${matchedSegments[1].timing.startTime.toFixed(6)}~${matchedSegments[1].timing.endTime.toFixed(6)}ì´ˆ`);\n  }\n  if (logoData && matchedSegments.length > 6) {\n    console.log(`  â° ì„¸ê·¸ë¨¼íŠ¸ 6 (ë¡œê³ ): ${matchedSegments[6].timing.startTime.toFixed(6)}~${matchedSegments[6].timing.endTime.toFixed(6)}ì´ˆ`);\n  }\n}\nconsole.log(`  âœ… ë¹„ë””ì˜¤ ì²˜ë¦¬ ì¤€ë¹„: ${result.readyForVideoComposition ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ'}`);\n\nreturn [result];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        400,
        -1000
      ],
      "id": "d4b032ef-fe34-4846-9e75-59faa43ccd65",
      "name": "Data Aggregator",
      "executeOnce": true,
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "jsCode": "// === Simple Video Processor ìˆ˜ì • - íƒ€ì´ë° ë¬¸ì œ í•´ê²° ===\n\nconsole.log('ğŸ¬ Simple Video Processor ì‹œì‘ (íƒ€ì´ë° ë¬¸ì œ í•´ê²° ë²„ì „)');\n\n// Data Aggregatorì—ì„œ ë°›ì€ ë°ì´í„°\nconst aggregatedData = $input.first().json;\nconst matchedSegments = aggregatedData.matchedSegments;\nconst narrationAudio = aggregatedData.narrationAudio;\nconst backgroundMusic = aggregatedData.backgroundMusic;\nconst wordSubtitleData = aggregatedData.wordSubtitleData;\nconst animatedLogo = aggregatedData.animatedLogo;\n\nconsole.log(`ğŸ“Š ì²˜ë¦¬í•  ì„¸ê·¸ë¨¼íŠ¸: ${matchedSegments.length}ê°œ`);\n\n// ì‘ì—… ë””ë ‰í† ë¦¬ ìƒì„±\nconst timestamp = new Date().toISOString().replace(/[:.]/g, '').slice(0, 15);\nconst workDir = `/tmp/video_work/${timestamp}`;\n\nconsole.log(`ğŸ“ ì‘ì—… ë””ë ‰í† ë¦¬: ${workDir}`);\n\n// Google Drive URL ì •ê·œí™” í•¨ìˆ˜\nfunction normalizeGoogleDriveUrl(url) {\n  if (!url) return url;\n  \n  // /file/d/ íŒ¨í„´ì„ /uc?id= íŒ¨í„´ìœ¼ë¡œ ë³€í™˜\n  if (url.includes('/file/d/')) {\n    const fileIdMatch = url.match(/\\/file\\/d\\/([a-zA-Z0-9_-]+)/);\n    if (fileIdMatch) {\n      const fileId = fileIdMatch[1];\n      return `https://drive.google.com/uc?id=${fileId}&export=download`;\n    }\n  }\n  \n  // ì´ë¯¸ /uc?id= í˜•ì‹ì´ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜\n  return url;\n}\n\n// FFmpeg ëª…ë ¹ì–´ ìƒì„± í•¨ìˆ˜\nfunction generateFFmpegCommand() {\n  console.log('ğŸ”§ FFmpeg ëª…ë ¹ì–´ ìƒì„± ì¤‘...');\n  \n  // ğŸ¯ í•µì‹¬ ìˆ˜ì •: ì´ ê¸¸ì´ë¥¼ ë§ˆì§€ë§‰ ì„¸ê·¸ë¨¼íŠ¸ì˜ endTimeìœ¼ë¡œ ê³„ì‚°\n  const totalDuration = matchedSegments[matchedSegments.length - 1].timing.endTime;\n  console.log(`ğŸ“ ì´ ì˜ìƒ ê¸¸ì´: ${totalDuration}ì´ˆ (ë§ˆì§€ë§‰ ì„¸ê·¸ë¨¼íŠ¸ endTime ê¸°ì¤€)`);\n  \n  // 1. ì…ë ¥ íŒŒì¼ë“¤\n  let inputs = [];\n  let inputIndex = 0;\n  \n  // ì„¸ê·¸ë¨¼íŠ¸ë³„ ì…ë ¥ ì²˜ë¦¬\n  matchedSegments.forEach((segment, i) => {\n    if (segment.type === 'generated_video') {\n      // ë¹„ë””ì˜¤: ì´ë¯¸ ì†ë„ ì¡°ì •ëœ íŒŒì¼ ì‚¬ìš©\n      inputs.push(`-i adjusted_segment_${i}.mp4`);\n      console.log(`  ğŸ“¹ ì…ë ¥[${inputIndex}]: adjusted_segment_${i}.mp4 (ë¹„ë””ì˜¤)`);\n    } else if (segment.type === 'generated_image') {\n      // ì´ë¯¸ì§€: PNGë¡œ í†µì¼\n      inputs.push(`-i segment_${i}.png`);\n      console.log(`  ğŸ–¼ï¸  ì…ë ¥[${inputIndex}]: segment_${i}.png (ì´ë¯¸ì§€)`);\n    } else if (segment.type === 'animated_logo') {\n      // ğŸ¯ ìˆ˜ì •: ë¡œê³ ëŠ” 1ì´ˆë¡œ ì œí•œí•˜ë˜ ì „ì²´ íƒ€ì´ë°ì— í¬í•¨\n      inputs.push(`-i segment_${i}.mp4`);\n      console.log(`  ğŸ¯ ì…ë ¥[${inputIndex}]: segment_${i}.mp4 (ë¡œê³ )`);\n    }\n    inputIndex++;\n  });\n  \n  // ğŸ¯ ìˆ˜ì •: ì˜¤ë””ì˜¤ íŒŒì¼ë“¤ - ì›ë³¸ íŒŒì¼ëª… ì‚¬ìš©\n  const narrationFileName = narrationAudio ? narrationAudio.name : 'narration.mp3';\n  const bgmFileName = backgroundMusic ? backgroundMusic.name : 'bgm.mp3';\n  \n  inputs.push(`-i \"${narrationFileName}\"`);\n  inputs.push(`-i \"${bgmFileName}\"`);\n  console.log(`  ğŸ§ ì…ë ¥[${inputIndex}]: ${narrationFileName} (ë‚˜ë ˆì´ì…˜)`);\n  console.log(`  ğŸµ ì…ë ¥[${inputIndex + 1}]: ${bgmFileName} (BGM)`);\n  \n  const narrationIndex = inputIndex;\n  const bgmIndex = inputIndex + 1;\n  \n  // 2. í•„í„° ë³µí•©ì²´ ìƒì„± (60fps í†µì¼ ì ìš©)\n  let filterComplex = [];\n  let videoLabels = [];\n  \n  matchedSegments.forEach((segment, i) => {\n    const videoLabel = `v${i}`;\n    videoLabels.push(`[${videoLabel}]`);\n    \n    if (segment.type === 'generated_video') {\n      // ë¹„ë””ì˜¤: ì„¸ë¡œ ë³€í™˜ + 60fps ì„¤ì •\n      filterComplex.push(\n        `[${i}:v]scale=1080:1920:force_original_aspect_ratio=decrease,pad=1080:1920:(ow-iw)/2:(oh-ih)/2:color=black,setsar=1,fps=60[${videoLabel}]`\n      );\n      console.log(`  ğŸ¬ ì„¸ê·¸ë¨¼íŠ¸ ${i}: ë¹„ë””ì˜¤ ì²˜ë¦¬ (60fps, ${segment.timing.duration}ì´ˆ)`);\n      \n    } else if (segment.type === 'generated_image') {\n      // ì´ë¯¸ì§€: ì¼„ë²ˆ íš¨ê³¼ + 60fps í†µì¼\n      const timing = segment.timing;\n      const frameCount = Math.round(timing.duration * 60); // 60fps ê¸°ì¤€ í”„ë ˆì„ìˆ˜\n      \n      // ì¼„ë²ˆ íš¨ê³¼ë³„ ì„¤ì •\n      const kenBurnsEffects = [\n        { // ì„¸ê·¸ë¨¼íŠ¸ 2: Safety Sweep L2R\n          filter: `zoompan=z='1.40-0.40*(on/${frameCount})':d=${frameCount}:x='(iw-iw/zoom)*(0.1+0.6*(on/${frameCount}))':y='(ih-ih/zoom)/2':s=1080x1920:fps=60`\n        },\n        { // ì„¸ê·¸ë¨¼íŠ¸ 3: Diagonal Drift  \n          filter: `zoompan=z='1+0.45*(on/${frameCount})':d=${frameCount}:x='(iw-iw/zoom)*(0.10+0.60*(on/${frameCount}))':y='(ih-ih/zoom)*(0.10+0.60*(on/${frameCount}))+0.03*(ih-ih/zoom)*sin(PI*on/${frameCount})':s=1080x1920:fps=60`\n        },\n        { // ì„¸ê·¸ë¨¼íŠ¸ 4: One-Bounce Tilt\n          filter: `zoompan=z='1+0.50*(on/${frameCount})':d=${frameCount}:x='(iw-iw/zoom)/2':y='(ih-ih/zoom)*(0.50-0.30*(on/${frameCount})+0.05*sin(PI*on/${frameCount}))':s=1080x1920:fps=60`\n        },\n        { // ì„¸ê·¸ë¨¼íŠ¸ 5: Wide Sweep L2R\n          filter: `zoompan=z='1.3-0.2*(on/${frameCount})':d=${frameCount}:x='iw*0.05+iw*0.9*on/${frameCount}':y='ih/2-(ih*zoom)/2':s=1080x1920:fps=60`\n        }\n      ];\n      \n      // ì´ë¯¸ì§€ ì„¸ê·¸ë¨¼íŠ¸ ì¸ë±ìŠ¤ ê³„ì‚° (ë¹„ë””ì˜¤ ì„¸ê·¸ë¨¼íŠ¸ ì œì™¸)\n      const imageSegmentIndex = matchedSegments.slice(0, i).filter(s => s.type === 'generated_image').length;\n      const kenBurnsEffect = kenBurnsEffects[imageSegmentIndex] || kenBurnsEffects[0];\n      \n      filterComplex.push(\n        `[${i}:v]scale=1080:1920:force_original_aspect_ratio=decrease,pad=1080:1920:(ow-iw)/2:(oh-ih)/2:color=black,setsar=1,${kenBurnsEffect.filter}[${videoLabel}]`\n      );\n      console.log(`  ğŸ¨ ì„¸ê·¸ë¨¼íŠ¸ ${i}: ì¼„ë²ˆ íš¨ê³¼ (${timing.duration}ì´ˆ, ${frameCount}í”„ë ˆì„, 60fps)`);\n      \n    } else if (segment.type === 'animated_logo') {\n      // ğŸ¯ ìˆ˜ì •: ë¡œê³  ì²˜ë¦¬ - 1ì´ˆ duration ì ìš©í•˜ë˜ 60fpsë¡œ ì²˜ë¦¬\n      const logoDuration = segment.timing.duration; // 1ì´ˆ\n      const logoFrameCount = Math.round(logoDuration * 60);\n      \n      filterComplex.push(\n        `[${i}:v]scale=1080:1920:force_original_aspect_ratio=decrease,pad=1080:1920:(ow-iw)/2:(oh-ih)/2:color=black,setsar=1,fps=60,trim=duration=${logoDuration}[${videoLabel}]`\n      );\n      console.log(`  ğŸ¯ ì„¸ê·¸ë¨¼íŠ¸ ${i}: ë¡œê³  ì²˜ë¦¬ (${logoDuration}ì´ˆ, ${logoFrameCount}í”„ë ˆì„, 60fps)`);\n    }\n  });\n  \n  // 3. ë¹„ë””ì˜¤ íƒ€ì„ë¼ì¸ ì—°ê²° - ğŸ¯ ìˆ˜ì •: ëª¨ë“  ì„¸ê·¸ë¨¼íŠ¸ í¬í•¨\n  filterComplex.push(`${videoLabels.join('')}concat=n=${matchedSegments.length}:v=1:a=0[video_timeline]`);\n  console.log(`  ğŸ”— concat: ${matchedSegments.length}ê°œ ì„¸ê·¸ë¨¼íŠ¸ ì—°ê²°`);\n  \n  // 4. ìë§‰ ì¶”ê°€\n  filterComplex.push(`[video_timeline]ass=subtitle.ass[final_video]`);\n  \n  // 5. ì˜¤ë””ì˜¤ ì²˜ë¦¬ - ğŸ¯ ìˆ˜ì •: ë™ì  ì´ ê¸¸ì´ ì‚¬ìš©\n  const fadeOutTime = totalDuration - 1;\n  \n  filterComplex.push(\n    `[${bgmIndex}:a]volume=0.15,afade=t=in:st=0:d=1,afade=t=out:st=${fadeOutTime}:d=1,apad=pad_dur=${totalDuration}[bgm_faded]`\n  );\n  filterComplex.push(\n    `[${narrationIndex}:a]afade=t=out:st=${fadeOutTime}:d=1,apad=pad_dur=${totalDuration}[narration_padded]`\n  );\n  filterComplex.push(\n    `[narration_padded][bgm_faded]amix=inputs=2:duration=longest[final_audio]`\n  );\n  \n  // 6. ìµœì¢… FFmpeg ëª…ë ¹ì–´ ì¡°ë¦½ - ğŸ¯ ìˆ˜ì •: ë™ì  ì´ ê¸¸ì´ ì ìš©\n  const ffmpegCommand = [\n    'ffmpeg -y',\n    inputs.join(' '),\n    `-filter_complex \"${filterComplex.join(';')}\"`,\n    '-map [final_video]',\n    '-map [final_audio]',\n    '-c:v libx264',\n    '-preset medium',\n    '-crf 18',\n    '-profile:v high',\n    '-level:v 4.0',\n    '-pix_fmt yuv420p',\n    '-r 60', // 60fps ì¶œë ¥ ìœ ì§€\n    '-s 1080x1920',\n    '-c:a aac',\n    '-b:a 320k',\n    '-ar 48000',\n    `-t ${totalDuration}`, // ğŸ¯ í•µì‹¬ ìˆ˜ì •: ë™ì  ì´ ê¸¸ì´ ì‚¬ìš©\n    '-movflags +faststart',\n    '-avoid_negative_ts make_zero',\n    'output_final_video.mp4'\n  ].join(' ');\n  \n  return ffmpegCommand;\n}\n\n// ë‹¤ìš´ë¡œë“œ ëª…ë ¹ì–´ ìƒì„±\nfunction generateDownloadCommands() {\n  const commands = [];\n  \n  matchedSegments.forEach((segment, i) => {\n    const normalizedUrl = normalizeGoogleDriveUrl(segment.url);\n    \n    if (segment.type === 'generated_image') {\n      commands.push(`wget -O \"segment_${i}.png\" \"${normalizedUrl}\"`);\n    } else if (segment.type === 'generated_video') {\n      commands.push(`wget -O \"segment_${i}.mp4\" \"${normalizedUrl}\"`);\n    } else if (segment.type === 'animated_logo') {\n      commands.push(`wget -O \"segment_${i}.mp4\" \"${normalizedUrl}\"`);\n    }\n  });\n  \n  // ğŸ¯ ìˆ˜ì •: ë‚˜ë ˆì´ì…˜ ì˜¤ë””ì˜¤ë¥¼ ì›ë³¸ íŒŒì¼ëª…ìœ¼ë¡œ ì €ì¥\n  if (narrationAudio) {\n    const normalizedNarrationUrl = normalizeGoogleDriveUrl(narrationAudio.url);\n    const narrationFileName = narrationAudio.name; // ì›ë³¸ íŒŒì¼ëª… ì‚¬ìš©\n    commands.push(`wget -O \"${narrationFileName}\" \"${normalizedNarrationUrl}\"`);\n  }\n  \n  // ğŸ¯ ìˆ˜ì •: BGMë„ ì›ë³¸ íŒŒì¼ëª…ìœ¼ë¡œ ì €ì¥\n  if (backgroundMusic) {\n    const normalizedBgmUrl = normalizeGoogleDriveUrl(backgroundMusic.url);\n    const bgmFileName = backgroundMusic.name; // ì›ë³¸ íŒŒì¼ëª… ì‚¬ìš©\n    commands.push(`wget -O \"${bgmFileName}\" \"${normalizedBgmUrl}\"`);\n  }\n  \n  return commands;\n}\n\n// ASS ìë§‰ íŒŒì¼ ìƒì„±\nfunction generateSubtitleContent() {\n  if (!wordSubtitleData || !wordSubtitleData.subtitleFiles || !wordSubtitleData.subtitleFiles.ass) {\n    return `[Script Info]\nTitle: Default Subtitle\nScriptType: v4.00+\n\n[V4+ Styles]\nFormat: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding\nStyle: Default,Arial,20,&H00FFFFFF,&H000000FF,&H00000000,&H00000000,0,0,0,0,100,100,0,0,1,2,0,2,10,10,10,1\n\n[Events]\nFormat: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text`;\n  }\n  \n  const assData = wordSubtitleData.subtitleFiles.ass;\n  \n  if (typeof assData === 'object' && assData.content) {\n    console.log('ğŸ“ ìë§‰ ë°ì´í„°ì—ì„œ content í•„ë“œ ì¶”ì¶œ ì¤‘...');\n    return assData.content.replace(/\\\\n/g, '\\n');\n  } else if (typeof assData === 'string') {\n    return assData;\n  } else {\n    console.log('âš ï¸ ìë§‰ ë°ì´í„° í˜•ì‹ì„ ì¸ì‹í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ìë§‰ ì‚¬ìš©.');\n    return `[Script Info]\nTitle: Default Subtitle\nScriptType: v4.00+\n\n[V4+ Styles]\nFormat: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding\nStyle: Default,Arial,20,&H00FFFFFF,&H000000FF,&H00000000,&H00000000,0,0,0,0,100,100,0,0,1,2,0,2,10,10,10,1\n\n[Events]\nFormat: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text`;\n  }\n}\n\n// ëª¨ë“  ì˜ìƒ ì„¸ê·¸ë¨¼íŠ¸ ì†ë„ ì¡°ì • ìŠ¤í¬ë¦½íŠ¸\nfunction generateVideoAdjustmentScript() {\n  const videoSegments = matchedSegments.filter(segment => segment.type === 'generated_video');\n  \n  if (videoSegments.length === 0) {\n    return '';\n  }\n  \n  let script = '\\n# ì˜ìƒ ì„¸ê·¸ë¨¼íŠ¸ë“¤ ë™ì  ì†ë„ ì¡°ì •\\n';\n  \n  videoSegments.forEach((segment, index) => {\n    const segmentIndex = matchedSegments.findIndex(s => s.segmentId === segment.segmentId);\n    const targetDuration = segment.timing.duration;\n    \n    script += `\n# ì„¸ê·¸ë¨¼íŠ¸ ${segmentIndex} ë™ì  ì†ë„ ì¡°ì •\nORIGINAL_DURATION_${segmentIndex}=$(ffprobe -v quiet -show_entries format=duration -of csv=p=0 segment_${segmentIndex}.mp4)\nTARGET_DURATION_${segmentIndex}=${targetDuration}\nSPEED_FACTOR_${segmentIndex}=$(awk -v o=\"$ORIGINAL_DURATION_${segmentIndex}\" -v d=\"$TARGET_DURATION_${segmentIndex}\" 'BEGIN{printf \"%.6f\", d/o}')\necho \"ì„¸ê·¸ë¨¼íŠ¸ ${segmentIndex}: ì›ë³¸ \\${ORIGINAL_DURATION_${segmentIndex}}ì´ˆ â†’ ëª©í‘œ ${targetDuration}ì´ˆ (SPEED_FACTOR: \\${SPEED_FACTOR_${segmentIndex}})\"\n\nffmpeg -y -i \"segment_${segmentIndex}.mp4\" \\\\\n  -vf \"scale=1080:1920:force_original_aspect_ratio=decrease,pad=1080:1920:(ow-iw)/2:(oh-ih)/2:color=black,setsar=1,setpts=\\${SPEED_FACTOR_${segmentIndex}}*PTS,fps=60\" \\\\\n  -c:v libx264 -preset fast -crf 23 -pix_fmt yuv420p -an \\\\\n  \"adjusted_segment_${segmentIndex}.mp4\"\necho \"âœ… adjusted_segment_${segmentIndex}.mp4 ìƒì„± ì™„ë£Œ\"\n`;\n  });\n  \n  return script;\n}\n\n// ë©”ì¸ ì‹¤í–‰\nconst ffmpegCommand = generateFFmpegCommand();\nconst downloadCommands = generateDownloadCommands();\nconst subtitleContent = generateSubtitleContent();\nconst videoAdjustmentScript = generateVideoAdjustmentScript();\n\n// ğŸ¯ ì´ ê¸¸ì´ ê³„ì‚° ë¡œì§ ì¶”ê°€\nconst totalDuration = matchedSegments[matchedSegments.length - 1].timing.endTime;\n\n// ğŸ¯ ì¶”ê°€: íŒŒì¼ëª… ì •ë³´\nconst narrationFileName = narrationAudio ? narrationAudio.name : 'narration.mp3';\nconst bgmFileName = backgroundMusic ? backgroundMusic.name : 'bgm.mp3';\n\n// ê²°ê³¼ ìƒì„±\nconst result = {\n  success: true,\n  workDir: workDir,\n  ffmpegCommand: ffmpegCommand,\n  totalDuration: totalDuration, // ğŸ¯ ì¶”ê°€: ì´ ê¸¸ì´ ì •ë³´\n  \n  script: `#!/bin/bash\n# === ì„¸ë¡œ ì˜ìƒ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ (íƒ€ì´ë° ë¬¸ì œ í•´ê²° v5 + íŒŒì¼ëª… ìˆ˜ì •) ===\n# ìƒì„± ì‹œê°: ${new Date().toLocaleString('ko-KR')}\n# ì‘ì—… í´ë”: ${workDir}\n# í•´ìƒë„: 1080x1920 (9:16 ì„¸ë¡œ ë¹„ìœ¨)\n# ì´ ê¸¸ì´: ${totalDuration}ì´ˆ (D+2 êµ¬ì¡°)\n# ìˆ˜ì •ì‚¬í•­: íƒ€ì´ë° ë¡œì§ ìˆ˜ì • + ë¡œê³  ì„¸ê·¸ë¨¼íŠ¸ í¬í•¨ + ì›ë³¸ íŒŒì¼ëª… ì‚¬ìš©\n\necho \"ğŸ“± ì„¸ë¡œ ì˜ìƒ ìƒì„± ì‹œì‘ (íƒ€ì´ë° ë¬¸ì œ í•´ê²° v5 + íŒŒì¼ëª… ìˆ˜ì •)\"\necho \"ğŸ“ ëª©í‘œ ì´ ê¸¸ì´: ${totalDuration}ì´ˆ\"\necho \"ğŸ§ ë‚˜ë ˆì´ì…˜ íŒŒì¼ëª…: ${narrationFileName}\"\necho \"ğŸµ BGM íŒŒì¼ëª…: ${bgmFileName}\"\n\n# ì‘ì—… í´ë” ìƒì„± ë° ì´ë™\nmkdir -p \"${workDir}\"\ncd \"${workDir}\"\necho \"ğŸ“ ì‘ì—… í´ë” ìƒì„±: ${workDir}\"\n\n# í™˜ê²½ í™•ì¸ ë° ë„êµ¬ ì„¤ì¹˜\necho \"ğŸ” í™˜ê²½ í™•ì¸:\"\necho \"  - í˜„ì¬ ê²½ë¡œ: $(pwd)\"\necho \"  - wget ì‚¬ìš© ê°€ëŠ¥: $(which wget || echo 'wget ì—†ìŒ')\"\necho \"  - ffmpeg ì‚¬ìš© ê°€ëŠ¥: $(which ffmpeg || echo 'ffmpeg ì—†ìŒ')\"\n\nif ! command -v wget &> /dev/null; then\n    echo \"ğŸ“¦ wget ì„¤ì¹˜ ì¤‘...\"\n    apk add --no-cache wget\nfi\n\nif ! command -v ffmpeg &> /dev/null; then\n    echo \"ğŸ“¦ ffmpeg ì„¤ì¹˜ ì¤‘...\"\n    apk add --no-cache ffmpeg\nfi\n\n# íŒŒì¼ ë‹¤ìš´ë¡œë“œ\necho \"ğŸ“¥ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì¤‘...\"\n${downloadCommands.map(cmd => `echo \"  ${cmd}\"\n${cmd}\necho \"  ë‹¤ìš´ë¡œë“œ ê²°ê³¼: $?\"`).join('\\n')}\n\necho \"âœ… ëª¨ë“  íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ\"\n\n# ë‹¤ìš´ë¡œë“œëœ íŒŒì¼ í™•ì¸\necho \"ğŸ“‚ ë‹¤ìš´ë¡œë“œëœ íŒŒì¼ ëª©ë¡:\"\nls -la\necho \"ğŸ§ ë‚˜ë ˆì´ì…˜ íŒŒì¼ í™•ì¸: $(ls -lh \"${narrationFileName}\" 2>/dev/null || echo 'íŒŒì¼ ì—†ìŒ')\"\necho \"ğŸµ BGM íŒŒì¼ í™•ì¸: $(ls -lh \"${bgmFileName}\" 2>/dev/null || echo 'íŒŒì¼ ì—†ìŒ')\"\n\n# ASS ìë§‰ íŒŒì¼ ìƒì„±\ncat > subtitle.ass << 'EOF'\n${subtitleContent}\nEOF\n\necho \"ğŸ“ ASS ìë§‰ íŒŒì¼ ìƒì„± ì™„ë£Œ\"\n\n${videoAdjustmentScript}\n\n# ìµœì¢… ì˜ìƒ í•©ì„± FFmpeg ì‹¤í–‰\necho \"âš™ï¸ ìµœì¢… ì˜ìƒ í•©ì„± FFmpeg ì‹¤í–‰ ì¤‘... (1080x1920, 60fps, ${totalDuration}ì´ˆ)\"\necho \"ğŸ¯ í•µì‹¬ ìˆ˜ì •ì‚¬í•­:\"\necho \"  1. âœ… ì´ ê¸¸ì´ë¥¼ ë§ˆì§€ë§‰ ì„¸ê·¸ë¨¼íŠ¸ endTime(${totalDuration}ì´ˆ)ìœ¼ë¡œ ì„¤ì •\"\necho \"  2. âœ… ëª¨ë“  ${matchedSegments.length}ê°œ ì„¸ê·¸ë¨¼íŠ¸ í¬í•¨ (ë¡œê³  í¬í•¨)\"\necho \"  3. âœ… ë™ì  íƒ€ì´ë° ê³„ì‚° ì ìš©\"\necho \"  4. âœ… ì›ë³¸ íŒŒì¼ëª… ì‚¬ìš© (ë‚˜ë ˆì´ì…˜: ${narrationFileName}, BGM: ${bgmFileName})\"\n\n${ffmpegCommand}\n\nif [ $? -eq 0 ]; then\n    echo \"âœ… ì„¸ë¡œ ì˜ìƒ ìƒì„± ì™„ë£Œ: output_final_video.mp4 (íƒ€ì´ë° ë¬¸ì œ í•´ê²° v5 + íŒŒì¼ëª… ìˆ˜ì •)\"\n    echo \"ğŸ“Š ìµœì¢… íŒŒì¼ ì •ë³´:\"\n    ls -lh output_final_video.mp4\n    \n    echo \"ğŸ¯ í•´ìƒë„ í™•ì¸:\"\n    ffprobe -v quiet -select_streams v:0 -show_entries stream=width,height -of csv=s=x:p=0 output_final_video.mp4\n    \n    echo \"ğŸ• ì˜ìƒ ê¸¸ì´ í™•ì¸:\"\n    ACTUAL_DURATION=$(ffprobe -v quiet -show_entries format=duration -of csv=p=0 output_final_video.mp4)\n    echo \"$ACTUAL_DURATION\"\n    echo \"ğŸ¯ ëª©í‘œ ê¸¸ì´: ${totalDuration}ì´ˆ, ì‹¤ì œ ê¸¸ì´: \\${ACTUAL_DURATION}ì´ˆ\"\n    \n    echo \"ğŸ¬ í”„ë ˆì„ë ˆì´íŠ¸ í™•ì¸:\"\n    ffprobe -v quiet -select_streams v:0 -show_entries stream=r_frame_rate -of csv=s=x:p=0 output_final_video.mp4\nelse\n    echo \"âŒ ì„¸ë¡œ ì˜ìƒ ìƒì„± ì‹¤íŒ¨\"\n    echo \"ğŸ“ ì‹¤íŒ¨ ì›ì¸ ë¶„ì„ì„ ìœ„í•œ íŒŒì¼ ëª©ë¡:\"\n    ls -la\n    exit 1\nfi\n\necho \"ğŸ¯ ì„¸ë¡œ ì˜ìƒ ë Œë”ë§ ì™„ë£Œ: ${workDir}/output_final_video.mp4\"\necho \"ğŸ“± í•´ìƒë„: 1080x1920 (Instagram Reels, YouTube Shorts, TikTok ìµœì í™”)\"\necho \"ğŸ“ ì´ ê¸¸ì´: ${totalDuration}ì´ˆ (D+2 êµ¬ì¡°: ìë§‰+ì„¸ê·¸ë¨¼íŠ¸5í™•ì¥+ë¡œê³ )\"\necho \"ğŸµ ì˜¤ë””ì˜¤: ë‚˜ë ˆì´ì…˜(${narrationFileName}) + BGM(${bgmFileName}) ë¯¹ì‹±\"\necho \"ğŸ¬ ì„¸ê·¸ë¨¼íŠ¸: ${matchedSegments.length}ê°œ ëª¨ë‘ í¬í•¨\"\necho \"ğŸ• í”„ë ˆì„ë ˆì´íŠ¸: 60fps (ëª¨ë“  ì„¸ê·¸ë¨¼íŠ¸ í†µì¼)\"\necho \"ğŸ”§ ì£¼ìš” ìˆ˜ì •ì‚¬í•­: ë™ì  íƒ€ì´ë° ê³„ì‚° + ë¡œê³  ì„¸ê·¸ë¨¼íŠ¸ í¬í•¨ + ì›ë³¸ íŒŒì¼ëª… ì‚¬ìš©\"\n`,\n\n  downloadCommands: downloadCommands,\n  \n  metadata: {\n    timestamp: new Date().toISOString(),\n    workDir: workDir,\n    resolution: \"1080x1920\",\n    aspectRatio: \"9:16\",\n    framerate: 60,\n    segments: matchedSegments.length,\n    totalDuration: totalDuration,\n    narrationFileName: narrationFileName,\n    bgmFileName: bgmFileName,\n    fixes: [\n      \"dynamic_total_duration_calculation\",\n      \"all_segments_included\", \n      \"logo_segment_processing\",\n      \"timing_logic_fixed\",\n      \"original_filename_usage\"\n    ],\n    processingMethod: \"dynamic_timing_calculation_v5_filename_fix\"\n  },\n  \n  message: `íƒ€ì´ë° ë¬¸ì œ í•´ê²° ì™„ë£Œ: ì´ ${totalDuration}ì´ˆ (D+2 êµ¬ì¡°), ${matchedSegments.length}ê°œ ì„¸ê·¸ë¨¼íŠ¸ ëª¨ë‘ í¬í•¨, ì›ë³¸ íŒŒì¼ëª… ì‚¬ìš©`\n};\n\nconsole.log('\\nâœ… Simple Video Processor ì™„ë£Œ (íƒ€ì´ë° ë¬¸ì œ í•´ê²° + íŒŒì¼ëª… ìˆ˜ì •):');\nconsole.log(`  ğŸ“ ì´ ê¸¸ì´: ${totalDuration}ì´ˆ (ë§ˆì§€ë§‰ ì„¸ê·¸ë¨¼íŠ¸ endTime ê¸°ì¤€)`);\nconsole.log(`  ğŸ“¹ ì´ ì„¸ê·¸ë¨¼íŠ¸: ${matchedSegments.length}ê°œ`);\nconsole.log(`  ğŸ§ ë‚˜ë ˆì´ì…˜ íŒŒì¼ëª…: ${narrationFileName}`);\nconsole.log(`  ğŸµ BGM íŒŒì¼ëª…: ${bgmFileName}`);\nconsole.log(`  ğŸ”§ ì£¼ìš” ìˆ˜ì •ì‚¬í•­:`);\nconsole.log(`    1. âœ… ì´ ê¸¸ì´ë¥¼ ë™ì ìœ¼ë¡œ ê³„ì‚° (${totalDuration}ì´ˆ)`);\nconsole.log(`    2. âœ… ëª¨ë“  ì„¸ê·¸ë¨¼íŠ¸ í¬í•¨ (ë¡œê³  í¬í•¨)`);\nconsole.log(`    3. âœ… concat í•„í„° ì„¸ê·¸ë¨¼íŠ¸ ìˆ˜ ì¼ì¹˜`);\nconsole.log(`    4. âœ… FFmpeg duration ì˜µì…˜ ìˆ˜ì •`);\nconsole.log(`    5. âœ… ì›ë³¸ íŒŒì¼ëª… ì‚¬ìš©ìœ¼ë¡œ ìºì‹± ë¬¸ì œ í•´ê²°`);\nconsole.log(`  ğŸ¬ ì¶œë ¥: 1080x1920, 60fps, ${totalDuration}ì´ˆ`);\n\nreturn [result];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        600,
        -1000
      ],
      "id": "fb88f7b8-b38a-4fc3-8236-9000ee289f38",
      "name": "FFmpeg Script Gen",
      "executeOnce": true,
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "jsCode": "// === File-based Script Executor v1 (ìˆ˜ì •ë¨) ===\n// Write Binary File ë…¸ë“œìš© ì½”ë“œ: bash ìŠ¤í¬ë¦½íŠ¸ë¥¼ íŒŒì¼ë¡œ ì €ì¥\nconsole.log('ğŸ“ File-based Script Executor v1 ì‹œì‘');\nconsole.log('ğŸ¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ íŒŒì¼ë¡œ ì €ì¥í•˜ì—¬ ì‹¤í–‰ ì¤€ë¹„');\n\n// ì…ë ¥ ë°ì´í„° ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜¤ê¸° (ë°°ì—´ í˜•íƒœ ì²˜ë¦¬)\nlet inputData;\nconst firstInput = $input.first().json;\n\n// ë°°ì—´ì¸ì§€ í™•ì¸í•˜ê³  ì²« ë²ˆì§¸ ìš”ì†Œ ì¶”ì¶œ\nif (Array.isArray(firstInput)) {\n  inputData = firstInput[0];\n  console.log('ğŸ“¦ ë°°ì—´ í˜•íƒœ ì…ë ¥ ë°ì´í„° ê°ì§€, ì²« ë²ˆì§¸ ìš”ì†Œ ì¶”ì¶œ');\n} else {\n  inputData = firstInput;\n  console.log('ğŸ“¦ ê°ì²´ í˜•íƒœ ì…ë ¥ ë°ì´í„° ê°ì§€');\n}\n\nconsole.log('ğŸ“Š ì…ë ¥ ë°ì´í„° í‚¤ë“¤:', Object.keys(inputData));\nconsole.log('ğŸ” ì…ë ¥ ë°ì´í„° íƒ€ì…:', typeof inputData);\n\n// bash ìŠ¤í¬ë¦½íŠ¸ ì•ˆì „í•˜ê²Œ ì¶”ì¶œ (ì‹¤ì œ í•„ë“œëª…ì— ë§ê²Œ ìˆ˜ì •)\nlet bashScript;\nif (inputData.script) {\n  bashScript = inputData.script;\n  console.log('âœ… script í•„ë“œì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ë°œê²¬');\n} else if (inputData.bashScript) {\n  bashScript = inputData.bashScript;\n  console.log('âœ… bashScript í•„ë“œì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ë°œê²¬');\n} else if (inputData.executeCommand) {\n  bashScript = inputData.executeCommand;\n  console.log('âœ… executeCommand í•„ë“œì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ë°œê²¬');\n} else {\n  throw new Error('script, bashScript ë˜ëŠ” executeCommandê°€ ì…ë ¥ ë°ì´í„°ì— ì—†ìŠµë‹ˆë‹¤. ì‚¬ìš© ê°€ëŠ¥í•œ í‚¤: ' + Object.keys(inputData).join(', '));\n}\n\n// ìŠ¤í¬ë¦½íŠ¸ ìœ íš¨ì„± ê²€ì‚¬\nif (!bashScript || typeof bashScript !== 'string') {\n  throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ bash ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤');\n}\n\nconsole.log('ğŸ“„ ìŠ¤í¬ë¦½íŠ¸ ê¸¸ì´:', bashScript.length, 'ë¬¸ì');\nconsole.log('ğŸ”§ íŒŒì¼ ê¸°ë°˜ ì‹¤í–‰ìœ¼ë¡œ bash íŒŒì‹± ë¬¸ì œ í•´ê²°');\n\n// Write Binary File ë…¸ë“œì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¡œ ë³€í™˜\nconst scriptBuffer = Buffer.from(bashScript, 'utf8');\n\n// íŒŒì¼ëª… ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„ í¬í•¨)\nconst timestamp = new Date().toISOString().slice(0,19).replace(/[:\\-T]/g, '');\nconst scriptFileName = `video_processor_v1_${timestamp}.sh`;\n\nconsole.log('ğŸ’¾ ìƒì„±ë  íŒŒì¼ëª…:', scriptFileName);\nconsole.log('ğŸ“ ì €ì¥ ê²½ë¡œ: /tmp/' + scriptFileName);\n\n// Write Binary File ë…¸ë“œê°€ ë°›ì„ ë°ì´í„° í˜•ì‹ìœ¼ë¡œ ë°˜í™˜\nconst result = {\n  // ì›ë³¸ ë°ì´í„° ìœ ì§€\n  ...inputData,\n  \n  // íŒŒì¼ ì •ë³´\n  scriptFile: {\n    fileName: scriptFileName,\n    filePath: `/tmp/${scriptFileName}`,\n    content: bashScript,\n    size: scriptBuffer.length,\n    encoding: 'utf8'\n  },\n  \n  // Execute Commandì—ì„œ ì‚¬ìš©í•  ëª…ë ¹ì–´ë“¤\n  executionCommands: [\n    `chmod +x /tmp/${scriptFileName}`,\n    `/tmp/${scriptFileName}`\n  ],\n  \n  // ë‹¨ê³„ë³„ ì‹¤í–‰ ê°€ì´ë“œ\n  executionSteps: [\n    '1. Write Binary File ë…¸ë“œì—ì„œ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ ìƒì„±',\n    '2. Execute Command ë…¸ë“œì—ì„œ íŒŒì¼ ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬', \n    '3. Execute Command ë…¸ë“œì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰'\n  ],\n  \n  // ë©”íƒ€ë°ì´í„°\n  processingMethod: 'file_based_execution_v1',\n  bashParsingIssueResolved: true,\n  scriptVersion: 'v1',\n  timestamp: new Date().toISOString(),\n  \n  // ì›ë³¸ ìŠ¤í¬ë¦½íŠ¸ ì •ë³´\n  originalScriptSource: 'script field from input data'\n};\n\nconsole.log('âœ… File-based Script Executor v1 ì™„ë£Œ');\nconsole.log('ğŸ“‹ ì‹¤í–‰ ë‹¨ê³„:', result.executionSteps);\nconsole.log('âš¡ ì‹¤í–‰ ëª…ë ¹ì–´:', result.executionCommands);\n\n// Write Binary File ë…¸ë“œê°€ ì¸ì‹í•  ìˆ˜ ìˆëŠ” ë°”ì´ë„ˆë¦¬ ë°ì´í„° ë°˜í™˜\nreturn [{\n  json: result,\n  binary: {\n    data: {\n      data: scriptBuffer,\n      mimeType: 'text/plain',\n      fileName: scriptFileName,\n      fileExtension: 'sh'\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        800,
        -1000
      ],
      "id": "4dec3d88-ce87-4dcb-ba34-666624f8487d",
      "name": "Prep Script File",
      "executeOnce": true,
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "=/tmp/{{ $json.scriptFile.fileName }}",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        1000,
        -1000
      ],
      "id": "298965de-d6f5-40b7-ba49-5eefe62c0869",
      "name": "Write Script File"
    },
    {
      "parameters": {
        "command": "=mkdir -p /tmp/video_work"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        1200,
        -1000
      ],
      "id": "b2aad8ff-2f47-4ddb-bd50-b7837c83204c",
      "name": "Execute FFmpeg Command"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-5.1-preview-2025-11-14",
          "mode": "list",
          "cachedResultName": "GPT-5.1-Preview"
        },
        "messages": {
          "values": [
            {
              "content": "=ë‹¤ìŒ ë‚˜ë ˆì´ì…˜ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ YouTube Shortsìš© ë©”íƒ€ë°ì´í„°ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”:\n\në‚˜ë ˆì´ì…˜:{{ $('whisper data processor1').first().json.segmentTimings.map(segment => segment.text).join(' ') }}\nìœ„ ë‚´ìš©ì— ë§ëŠ” ì œëª©, ì„¤ëª…, íƒœê·¸ë¥¼ ìƒì„±í•˜ë˜:\n- ì œëª©: í´ë¦­ë¥  ë†’ì€ 60ì ì´ë‚´ ì œëª©\n- ì„¤ëª…: 150ì ì´ë‚´ + í•´ì‹œíƒœê·¸ í¬í•¨  \n- íƒœê·¸: ìœ íŠœë¸Œ ì‡¼ì¸ ì— ìµœì í™”ëœ í‚¤ì›Œë“œ í¬í•¨í•œ íƒœê·¸ 10ê°œ\n\nJSON í˜•ì‹ìœ¼ë¡œ ì¶œë ¥í•´ì£¼ì„¸ìš”."
            },
            {
              "content": "=# System Prompt: YouTube Shorts ë©”íƒ€ë°ì´í„° ìƒì„±\n\në‹¹ì‹ ì€ YouTube Shortsìš© ë©”íƒ€ë°ì´í„° ìƒì„± ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì£¼ì–´ì§„ ë‚˜ë ˆì´ì…˜ ë‚´ìš©ì„ ë¶„ì„í•˜ì—¬ ìµœì ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ìƒì„±í•˜ì„¸ìš”.\n\n## ìƒì„± ê·œì¹™\n\n### YouTube Tags (10 ê°œ)\n- ë‚˜ë ˆì´ì…˜ ë‚´ìš©ì—ì„œ **í•µì‹¬ í‚¤ì›Œë“œ** ì¶”ì¶œ\n- **YouTube Shorts, ì‡¼ì¸ , ì„¸ë¡œì˜ìƒ** í•„ìˆ˜ í¬í•¨\n- **AI, ì¸ê³µì§€ëŠ¥, ìë™í™”** ê¸°ìˆ  ê´€ë ¨ íƒœê·¸\n- **ë‰´ìŠ¤, ì†ë³´, ìµœì‹ ** ì‹œì˜ì„± íƒœê·¸\n- **íŠ¸ë Œë“œ, í™”ì œ, ì´ìŠˆ** í™•ì‚°ì„± íƒœê·¸\n\n### ì œëª© (Title)\n- **60ì ì´ë‚´**\n- **ì¶©ê²©ì ì´ê³  í´ë¦­í•˜ê³  ì‹¶ì€** ì œëª©\n- **í•µì‹¬ í‚¤ì›Œë“œ** í¬í•¨\n- **ê°ì • ìœ ë°œ** ë‹¨ì–´ ì‚¬ìš© (ë†€ë¼ìš´, ì¶©ê²©, ëŒ€ë°• ë“±)\n\n### ì„¤ëª… (Description)\n- **150ì ì´ë‚´**\n- **ì˜ìƒ ìš”ì•½** + **ê´€ë ¨ í•´ì‹œíƒœê·¸**\n- **êµ¬ë… ìœ ë„** ë¬¸êµ¬ í¬í•¨\n\n## ì¶œë ¥ í˜•ì‹\n```json\n{\n  \"title\": \"ìƒì„±ëœ ì œëª©\",\n  \"description\": \"ìƒì„±ëœ ì„¤ëª…\",\n  \"tags\": [\"íƒœê·¸1\", \"íƒœê·¸2\", \"íƒœê·¸3\", ...]\n}\n```",
              "role": "system"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        1400,
        -1000
      ],
      "id": "c4cd2d0c-9b3f-4493-914c-a4ce6e02345c",
      "name": "Generate Metadata (GPT-5)",
      "credentials": {
        "openAiApi": {
          "id": "SU7j97M3VqBRETt6",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "resource": "video",
        "operation": "upload",
        "title": "={{ $('Metadata Generate1').item.json.message.content.title }}",
        "regionCode": "KR",
        "categoryId": "=28",
        "options": {
          "description": "={{ $('Metadata Generate1').item.json.message.content.description }}",
          "notifySubscribers": true,
          "privacyStatus": "unlisted",
          "selfDeclaredMadeForKids": false,
          "tags": "={{ $('Metadata Generate1').item.json.message.content.tags.join(',') }}"
        }
      },
      "type": "n8n-nodes-base.youTube",
      "typeVersion": 1,
      "position": [
        1600,
        -1000
      ],
      "id": "6deffa95-94ee-48cb-a33f-397fa78a1010",
      "name": "YouTube Upload (KR)",
      "credentials": {
        "youTubeOAuth2Api": {
          "id": "cpLeI7xNofzl0Q7R",
          "name": "YouTube account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.blotato.com/v1/publish",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "blotato-api-key",
              "value": "YOUR_BLOTATO_KEY"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "jsonBody": "={\n  \"videoUrl\": \"{{ $json.videoUrl }}\",\n  \"title\": \"{{ $json.title }}\",\n  \"description\": \"{{ $json.description }}\",\n  \"platforms\": [\"instagram\", \"tiktok\", \"facebook\"]\n}",
        "options": {}
      },
      "name": "Blotato Multi-Platform",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1800,
        -1000
      ],
      "id": "blotato_node"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1AyIUgp55Rr88R5KMGvkBfMLCucWXsT0_AjhaLhV-_J8",
          "mode": "list",
          "cachedResultName": "AI news",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1AyIUgp55Rr88R5KMGvkBfMLCucWXsT0_AjhaLhV-_J8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1AyIUgp55Rr88R5KMGvkBfMLCucWXsT0_AjhaLhV-_J8/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "row_number": "={{ $('Webhook').item.json.body.row_number }}",
            "narration": "={{ $json.output.narration }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "Title",
              "displayName": "Title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Link",
              "displayName": "Link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "PubDate",
              "displayName": "PubDate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "summary",
              "displayName": "summary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Thread summary",
              "displayName": "Thread summary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "\bstart blog?",
              "displayName": "\bstart blog?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "blog done",
              "displayName": "blog done",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "start video?",
              "displayName": "start video?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "narration",
              "displayName": "narration",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "narration_confirmed",
              "displayName": "narration_confirmed",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "video_count",
              "displayName": "video_count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "continue video?",
              "displayName": "continue video?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "video links",
              "displayName": "video links",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "newsContent",
              "displayName": "newsContent",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Summary_Eng",
              "displayName": "Summary_Eng",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        2000,
        -1000
      ],
      "id": "58db3cde-b1a8-4ce8-b524-ac819923ca13",
      "name": "Log Final (AutoMap)",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "qHzPZhMeMIC0bqve",
          "name": "Google Sheets account"
        }
      }
    }
  ],
  "connections": {
    "Daily Trigger": {
      "main": [
        [
          {
            "node": "Prepare New Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "If: Generate New?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If: Generate New?": {
      "main": [
        [
          {
            "node": "Prepare New Data",
            "type": "main",
            "index": 0
            "node": "Log Script (AutoMap)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Script (AutoMap)": {
      "main": [
        [
          {
            "node": "Prepare Sentences",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Sentences": {
      "main": [
        [
          {
            "node": "Split Sentences",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Sentences": {
      "main": [
        [
          {
            "node": "Wait 3s",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait 3s": {
      "main": [
        [
          {
            "node": "Generate Image Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Image Prompt": {
      "main": [
        [
          {
            "node": "NanoBanana Image Gen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GPT-5.1 Model (Image)": {
      "ai_languageModel": [
        [
          {
            "node": "Generate Image Prompt",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "NanoBanana Image Gen": {
      "main": [
        [
          {
            "node": "Sora-2 (OpenAI)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sora-2 (OpenAI)": {
      "main": [
        [
          {
            "node": "OpenAI TTS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI TTS": {
      "main": [
        [
          {
            "node": "Whisper (Word-Level)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Whisper (Word-Level)": {
      "main": [
        [
          {
            "node": "Generate ASS Subtitles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate ASS Subtitles": {
      "main": [
        [
          {
            "node": "Data Aggregator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Data Aggregator": {
      "main": [
        [
          {
            "node": "FFmpeg Script Gen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FFmpeg Script Gen": {
      "main": [
        [
          {
            "node": "Prep Script File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prep Script File": {
      "main": [
        [
          {
            "node": "Write Script File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Write Script File": {
      "main": [
        [
          {
            "node": "Execute FFmpeg Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute FFmpeg Command": {
      "main": [
        [
          {
            "node": "Generate Metadata (GPT-5)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Metadata (GPT-5)": {
      "main": [
        [
          {
            "node": "YouTube Upload (KR)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "YouTube Upload (KR)": {
      "main": [
        [
          {
            "node": "Blotato Multi-Platform",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Blotato Multi-Platform": {
      "main": [
        [
          {
            "node": "Log Final (AutoMap)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "restored_v7_ultimate"
  }
}